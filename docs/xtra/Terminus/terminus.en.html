<!DOCTYPE HTML><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8" /><title>Terminus</title><meta name="description"content="The last and the first destination"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=edge" /><meta name="author" content="luffah"/><meta name="author" content="Shawn Conrad, Michele Pratusevich, michele.pratusevich@gmail.com"/><style>@font-face{font-family:term;src:url(terminal-grotesque-webfont.eot);src:url(terminal-grotesque-webfont.eot?#iefix) format("embedded-opentype"),url(terminal-grotesque-webfont.woff2) format("woff2"),url(terminal-grotesque-webfont.woff) format("woff"),url(terminal-grotesque-webfont.ttf) format("truetype"),url(terminal-grotesque-webfont.svg#terminal_grotesqueregular) format("svg");font-weight:400;font-style:normal}body{overflow-x:hidden;color:#efefef;background:#000;font-family:sans-serif;font-size:1.4rem;font-stretch:condensed;position:absolute;width:100%}#term{font-family:term}.color-ok{color:#90ee90}.color-ko{color:red}.color-pass{color:orange}.color-cmd{color:#7fff00}.color-room{color:orange}.color-people{color:#db7093}.color-item{color:#f0f}.color-item.color-executable{color:#8a2be2}.mesg{color:grey}.notifications{position:fixed;z-index:0;right:0;top:0}.inmsg{display:inline-block}.badge{position:relative;text-align:center;font-family:inherit}.badge-title{font-size:1.2em}.badge img{width:16ch}.badge-desc{opacity:1;-webkit-animation:disappear 1s 2s forwards;animation:disappear 1s 2s forwards}.notification{padding:1rem}.disappear{opacity:1;-webkit-animation:disappear 2s forwards;animation:disappear 2s forwards}@-webkit-keyframes disappear{to{opacity:0}}@keyframes disappear{to{opacity:0}}.badge-desc{position:absolute;top:100%;left:0}.badge-title{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:#000}.hashtag{color:indigo}.flash:after{content:"";position:fixed;width:100%;height:100%;top:0;left:0;-webkit-animation:flash .6s;animation:flash .6s;background:#fff}@-webkit-keyframes flash{0%{opacity:0}to{opacity:1}}@keyframes flash{0%{opacity:0}to{opacity:1}}.msg,button{border:none;font-size:inherit;font-family:inherit}.msg pre{display:inline}#term .passinput .input-wrapper{opacity:1%}#term .passinput .input-wrapper input{max-width:40ch}.choicebox{border:10px solid #efefef;padding:1.4rem;position:relative;z-index:10;box-sizing:border-box}.choicebox:after,.choicebox:before{content:"";display:block;position:absolute;z-index:-1;border:4px solid #22b14c;box-sizing:border-box}.choicebox:before{width:calc(100% + 8px);height:calc(100% - 8px);left:-4px;top:4px}.choicebox:after{height:calc(100% + 8px);width:calc(100% - 8px);top:-4px;left:4px}.ghost-monitor,.visually-hidden{position:absolute;left:-1000vw;top:0}.img-container{position:relative;z-index:0;width:100%;height:100%}.img-container .layers{position:relative;display:inline-block}.reverseY{-webkit-transform:scaleY(-1);transform:scaleY(-1)}.reverseX{-webkit-transform:scaleX(-1);transform:scaleX(-1)}.reverseY.reverseX{-webkit-transform:scale(-1);transform:scale(-1)}.img-container .layers .main{position:relative}.layers.room-cage .people:nth-child(n+2){position:absolute;bottom:0}.layers.room-cage .people:nth-child(2){left:-4rem;z-index:-1}.layers.room-cage .people:nth-child(3){left:4rem;z-index:-1}.layers .covering{z-index:1}.layer.item:not(.large){width:50%;height:50%}.img-container .layers .background,.img-container .layers .foreground,.img-container .livelayer{position:absolute;bottom:0;left:0;width:100%;display:-webkit-box;display:flex;-webkit-box-align:end;align-items:end}.img-container .layers .background{z-index:-1}.img-container .layers .foreground{z-index:1}.epicfromright{overflow:hidden}.epicfromright .layers{position:relative;left:100%}.epicfromright.loaded .layers{-webkit-animation:a 1.4s ease-out forwards;animation:a 1.4s ease-out forwards}.msg img{float:left}#term .input-container{position:relative;background:#000;bottom:0;left:0;width:100%}#term .input-div{padding:0}#term,#term .input-div{margin:auto;max-width:80ch;background:#000;box-sizing:border-box}#term{padding:1rem;position:relative}fieldset{border:none}img{display:block;max-width:100%}.screen:not(:last-of-type) .layers{-webkit-animation:fromfull 2s 1s forwards;animation:fromfull 2s 1s forwards}.msg>img{max-width:12ch}@-webkit-keyframes fromfull{0%{max-width:100%}to{max-width:12ch}}@keyframes fromfull{0%{max-width:100%}to{max-width:12ch}}@media (max-width:800px){:not(.battlescene)>.img-container .main img{min-width:80%}}.contribute:before{content:"<<";display:block;background:#000;position:absolute;left:-2rem;width:100%;height:100%}.contribute a{display:block;color:pink;text-align:center;position:relative;z-index:2}.contribute{padding:1rem;margin:0;position:fixed;right:-20ch;top:2em;background:#000;border:1px dashed pink;width:20ch;-webkit-transition:all .6s ease-in;transition:all .6s ease-in}.contribute:hover{right:0}#term .input:before{content:"$ ";position:absolute;left:0;top:0}#term .input{line-height:2;position:relative;margin:0;padding-left:2ch}#term input{display:inline-block;background:none;border:none;max-width:100%;font-size:inherit;font-family:inherit;color:inherit;outline:none;z-index:99}.suggest{flex-wrap:wrap}.belt,.suggest{display:-webkit-box;display:flex}.belt{margin:0 0 1rem}.belt button{padding:1ch;margin:0}.suggest button{color:grey}.suggest button.select{background:#fff;color:#000}.key{color:#f4f4f4;border:none}.key,button{background:none}button{-webkit-transition:color .6s;transition:color .6s;position:relative;height:3rem}button span{position:relative;z-index:1}button:before{content:" ";display:block;position:absolute;width:100%;height:0;top:50%;left:0;background:#000;-webkit-transition:all .5s;transition:all .5s}button:hover:before{background:#fff;height:3rem;top:0;-webkit-transition:all .4s;transition:all .4s}button:hover{color:#000}.tree{text-align:center}#term .choice input{display:none}.choice input:checked+.selectpointer{background:#22b14c}.choice input:checked~label{color:#22b14c}.selectpointer{position:relative;background:#494949;display:inline-block;height:.3ch;width:.3ch;top:-.4ch;margin-right:.6ch}.selectpointer:after,.selectpointer:before{content:"";display:block;position:absolute;background:inherit}.selectpointer:before{top:-100%;left:-100%;height:300%;width:100%}.selectpointer:after{top:-200%;left:-200%;height:500%;width:100%}.branch{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center}.branch *{margin:3px 0;padding:3px}.branchtitle{text-align:center}.screen:not(:last-of-type){opacity:.6}@-webkit-keyframes a{0%{-webkit-transform:translateX(-50%) rotate(-45deg);transform:translateX(-50%) rotate(-45deg);left:100%}20%{-webkit-transform:translateX(-50%) rotate(-1turn);transform:translateX(-50%) rotate(-1turn);left:0}40%{-webkit-transform:translateX(-50%) rotate(-1turn);transform:translateX(-50%) rotate(-1turn);left:0}50%{-webkit-transform:translateX(-50%) rotate(0deg);transform:translateX(-50%) rotate(0deg);bottom:10px;left:25%}to{-webkit-transform:translateX(-50%) rotate(1turn);transform:translateX(-50%) rotate(1turn);bottom:0;left:50%}}@keyframes a{0%{-webkit-transform:translateX(-50%) rotate(-45deg);transform:translateX(-50%) rotate(-45deg);left:100%}20%{-webkit-transform:translateX(-50%) rotate(-1turn);transform:translateX(-50%) rotate(-1turn);left:0}40%{-webkit-transform:translateX(-50%) rotate(-1turn);transform:translateX(-50%) rotate(-1turn);left:0}50%{-webkit-transform:translateX(-50%) rotate(0deg);transform:translateX(-50%) rotate(0deg);bottom:10px;left:25%}to{-webkit-transform:translateX(-50%) rotate(1turn);transform:translateX(-50%) rotate(1turn);bottom:0;left:50%}}@-webkit-keyframes slidein{0%{left:100%}to{left:0}}@keyframes slidein{0%{left:100%}to{left:0}}input[disabled=""]{opacity:0}.mystory{font-size:1.5em;font-family:term}.megaprompt{font-size:4.5vw;font-family:term}.megaprompt>*{margin:auto;display:block;padding:1em;box-sizing:border-box}#term .megaprompt input{background:#fff;color:#000}.battlescene .red{background:red}.battlescene .big img{width:150%;max-width:unset}.battlescene-container{z-index:999;background:#000;position:fixed;top:0;left:0;height:100vh;width:100vw;-webkit-animation:slidein 1.4s ease-out forwards;animation:slidein 1.4s ease-out forwards}.battlescene{position:relative;padding:0 1rem;margin:auto;max-width:80ch}.battlescene .img-container .layers{position:absolute}</style></head><body><div id="term"></div><iframe id="pogen" style="display:none;"></iframe><script>function addBtn(e,t,n,o,r){var i=dom.El("button");return def(t)&&(i.className=t),def(o)&&(i.title=o),def(n)&&(i.innerHTML="<span>"+n+"</span>"),def(r)&&(i.onclick=r),e.appendChild(i),i}function prEl(e,t,n){var o=dom.El(t);e.prepend(o);var r=typeof n;return"string"==r?o.className=n:"object"==r&&addAttrs(o,n),o}function addEl(e,t,n){var o=dom.El(t);e.appendChild(o);var r=typeof n;return"string"==r?o.className=n:"object"==r&&addAttrs(o,n),o}function span(e,t){return"<span class='"+e+"'>"+t+"</span>"}function injectProperties(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function union(e,t){var n={};for(var o in e)n[o]=e[o];for(var o in t)n[o]=t[o];return n}function almostEqual(e,t,n){return e==n||(e>n?n+t>e:e+t>n)}function addAttrs(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n]);return e}function objToStr(e){return e.toString()}function clone(e){if(eui++,null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=clone(e[n]));return t}function d(e,t){return"undefined"==typeof e?t:e}function anyStr(e,t){return"string"==typeof e?e:"string"==typeof t?t:null}function aStrArray(e){return"string"==typeof e?[e]:e&&e.length?e:[]}function rmIdxOf(e,t){return index=e.indexOf(t),index===-1?null:e.splice(index,1)}function isStr(e){return"string"==typeof e}function isObj(e){return"object"==typeof e}function def(e){return"undefined"!=typeof e}function ndef(e){return"undefined"==typeof e}function pushDef(e,t){return"undefined"!=typeof e&&(t.push(e),!0)}function cntUp(e,t){ndef(e[t])?e[t]=1:e[t]++}function hdef(e,t,n){ndef(e[t])&&(e[t]=[]),e[t].push(n)}function randomSort(){return.5-Math.random()}function shuffleStr(e,t){for(var n="!@#$)~_(%^&.abcdefghijklmnopqrstuvwxyz -0123456789".repeat(e.length/10+1).split("").sort(randomSort),o="",r=0;r<e.length;r++)o+=Math.random()>t?e[r]:n.shift();return o}function randomStr(e){var t=". abcdefghijklmnopqrstuvwxyz -0123456789".repeat(e).split("").sort(randomSort),n=t.slice(0,e).join("");return n}function Seq(){this.function_queue=[]}function objToMsg(e){return e.toMsg()}function guess_gettext_mod(e){return typ=e.split("_")[0],{decorate:type_decorations[typ]}}function var_resolve(e){return e=e.substring(2,e.length-2),var_vars_regexp.test(e)?(vars=JSON.parse(e.match(var_vars_regexp)),e=e.split(",")[0]):var_vars_regexpbis.test(e)?(b=e.split("."),e=b[0],vars=[b[1]]):vars=[],_(e,vars,guess_gettext_mod(e))}function _(e,t,n){if(!def(e))return"";"object"==typeof t&&0!==t.length||(t=["","","",""]),n=d(n,{});var o;if(e in dialog)o=dialog[e];else{if(poe&&pogen(e),!(n.or&&n.or in dialog))return o=e,t.length>0&&(o+=" "+t.join(" ")),o;e=o,o=dialog[n.or]}for(;var_regexp.test(o);)o=o.replace(var_regexp,var_resolve);return o=o.printf(t),n.decorate&&(o=n.decorate.printf([o])),o}function Cookie(e,t){this.name=e,this.minutes=t}function GameState(){this.params={},this.actions={},this.cookie=null,this.Event=function(e){state.apply(e.type)}}function EventTarget(){this._listeners={}}function SoundBank(e){this.ldr=0,this.dict={},this.callback=d(e,null)}function Music(e){this.current=0,this.currentmusic=null,this.soundbank=e}function setAudioLoop(e,t){e._loop=t}function setAudioFade(e,t){}function ReturnSequence(e){this.seq=e,this.isReturnSequence=!0,this.idx=0}function addspace(e){return e+" "}function overide(e){e.preventDefault(),e.stopPropagation()}function no_accents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function VTerm(e,t){var n=this;n.context=t,n.charduration=10,n.charfactor={"char":1," ":8," ":2,"!":10,"?":10,",":5,".":8,"\t":2,"\n":10,tag:10},n.charhtml={" ":"&nbsp;","\n":"<br>","\t":"&nbsp;&nbsp;"},n.complete_opts={"case":"i",fuzzy:no_accents,humanized:!0},n.imgs={},n.statkey={},n.history=[],n.disabled={},n.waiting_fus=[],n.histchecking=!1,n.histindex=0,n.scrl_lock=!1,n.cmdoutput=!0,n.suggestion_selected=null,n.container=dom.Id(e),n.monitor=addEl(n.container,"div","monitor"),n.ghost_monitor=prEl(document.body,"div","ghost-monitor"),n.notifications=addEl(document.body,"div","notifications"),n.last_notify=Date.now(),addAttrs(n.ghost_monitor,{role:"log","aria-live":"polite"}),n.inputdiv=addEl(addEl(n.container,"div","input-container"),"div","input-div"),n.cmdline=addEl(n.inputdiv,"p","input"),n.input=addEl(n.cmdline,"input",{size:80});var o=addEl(n.cmdline,"div","belt");addAttrs(n.cmdline,{role:"log","aria-live":"polite"});var r=addEl(o,"div","keys");n.suggestions=addEl(o,"div","suggest"),addAttrs(n.suggestions,{role:"log","aria-live":"polite","aria-relevant":"additions removals"}),n.btn_clear=addBtn(r,"key","✗","Ctrl-U",function(e){n.set_line(""),n.show_suggestions(_getCommands(this.context).map(addspace))}),n.btn_tab=addBtn(r,"key","↹","Tab",function(e){n.make_suggestions()}),n.btn_enter=addBtn(r,"key","↵","Enter",function(e){n.enterKey()}),n.msg_idx=0,n.soundbank={},n.badge_pic=new Pic("badge.png"),n.timeout={badge:3e3,scrl:100,notification:4e3},n.behave()}function _setUserName(e){e.length&&(user.name=e),state.set("usr",user.name)}function _setUserAddress(e){e.length&&(user.address=e),state.set("adr",user.address)}function _addGroup(e){user.groups.push(e)}function _hasGroup(e){return user.groups.indexOf(e)>-1}function _expandArgs(e,t){for(var n,o,r,i,a=[],s=0;s<e.length;s++)if(regexp_str.test(e[s]))a.push(e[s].slice(1,e[s].length-1));else if(regexp_star.test(e[s]))if(roomp=t.pathToRoom(e[s]),n=roomp[0],o=roomp[1],i=new RegExp(o.replace(/\./g,"\\.").replace(/\*/g,".*")),n&&o){r=roomp[2];for(var d=[],l=0;l<n.items.length;l++)i.test(n.items[l].toString())&&d.push(r+(r.length?"/":"")+n.items[l].toString());a=a.concat(d.sort())}else a.push(e[s]);else a.push(e[s]);return a}function _validArgs(e,t,n){return"ls"==e||1==t.length&&["man","cd","mkdir","less","touch","unzip"].indexOf(e)>-1}function commonprefix(e){for(var t=e.concat().sort(),n=t[0],o=t[t.length-1],r=n.length,i=0;i<r&&n.charAt(i)===o.charAt(i);)i++;return n.substring(0,i)}function _completeArgs(e,t,n,o,r){var i="~"==n.substring(0,1)?$home:o;n=n.replace(/\*/g,".*");var a,s=[],d=e[0],l=[ARGT.cmdname].concat(_getCommandSyntax(d));if(_argType(l,t,ARGT.cmdname)){var u=_getUserCommands();idx=0;for(var c=0;c<u.length;c++)r(u[c])&&s.push(u[c]+(u[c]==n?" ":""));return s}if(_argType(l,t,ARGT.msgid))return Object.keys(dialog).filter(function(e){return e.match("^"+n)}).slice(0,20);var m=n.split("/");for(_argType(l,t,ARGT.dir)&&1==m.length&&0===m[0].length&&s.push(".."),room_num=0;room_num<m.length;room_num++)if(a=i.can_cd(m[room_num]))i=a,room_num===m.length-1&&(ret=[a.name+"/"]);else if(room_num==m.length-1&&(_argType(l,t,ARGT.strictfile)||_argType(l,t,ARGT.file)||_argType(l,t,ARGT.dir))){for(child_num=0;child_num<i.children.length;child_num++)r(i.children[child_num].name,m[room_num])&&s.push(i.children[child_num].name+"/");if(_argType(l,t,ARGT.strictfile)||_argType(l,t,ARGT.file))for(item_num=0;item_num<i.items.length;item_num++)r(i.items[item_num].name,m[room_num])&&s.push(i.items[item_num].name)}return s}function _getCommands(e){var t,n=[];for(t=0;t<e.items.length;t++)e.items[t].executable&&n.push("./"+e.items[t].name);return n.concat(_getUserCommands())}function _parse_exec(e,t){var n=e.getContext(),o=t[0],r=!1;"sudo"==t[0]&&(t.shift(),o=t[0],r=!0);var i="",a=n;t.push(t.pop().replace(/\/$/,""));var s=_expandArgs(t.slice(1),a),d=null;if(o.match(/^(\.\/|\/)/)){var l=a.traversee(o),u=l.item,a=l.room;u&&u.executable&&(d=function(e,t){return u.exec(e,a,t)})}if(d||!r&&!_hasRightForCommand(o,a)||(d=_getCommandFunction(o)),!d)return o in a.cmd_text?(a.fire_event(e,o+"_cmd_text",s,0),i=a.cmd_text[o]):(a.fire_event(e,"cmd_not_found",s,0),a.fire_event(e,o+"_cmd_not_found",s,0),i=cmd_done(e,[[a,0]],_("cmd_not_found",[o,a.name]),"cmd_not_found",s)),i;for(var c,m,h=0;h<s.length;h++)if(c=n.traversee(s[h]),m=c.room,m&&!c.item&&!r&&0===h&&!_hasRightForCommand(o,m))return i=o in m.cmd_text?m.cmd_text[o]:_("cmd_not_found",[o,m.name]);var p=function(){r&&(n.sudo=!0);var t=d(s,e);return t?i=t:o in a.cmd_text&&(i=a.cmd_text[o]),n.sudo=!1,i};if(!r||n.supass)return i=p();var f=function(e,t){var o="";return"IHTFP"==e?(n.supass=!0,o=p()):o=_("room_wrong_password"),o};e.ask(_("ask_password"),f,{cls:"choicebox passinput",disappear:function(e){e()}})}function Command(e,t,n){this.fu=n,this.syntax=t,this.group=e}function _hasRightForCommand(e,t){return!!global_commands_fu[e]&&user.groups.indexOf(global_commands_fu[e].group)>-1}function _getUserCommands(){return Object.keys(global_commands_fu).filter(_hasRightForCommand)}function _argType(e,t,n){return n[0]===e[t][0]}function _getCommandFunction(e){return global_commands_fu[e].fu}function _getCommandSyntax(e){return global_commands_fu[e].syntax}function _setupCommand(e,t,n,o){global_commands_fu[e]=new Command(t||e,n,o)}function _lnCommand(e,t,n){var o=global_commands_fu[t];_setupCommand(e,n||e,o.syntax,o.fu)}function global_fire(e){if(global_fireables[e])for(;fun=global_fireables[e].shift();)fun()}function global_fire_done(){global_fire("done")}function cmd_done(e,t,n,o,r){var i=function(){for(var n=0;n<t.length;n++)t[n][0].fire_event(e,o+"_done",r,t[n][1]),global_fire_done()};return[n,i]}function Pic(e,t){this.src=e,t=d(t,{}),this.img_dir=d(t.img_dir,"./img/"),this.cls=t.cls,this.shown_in_ls=d(t.pic_shown_in_ls,!0),this.shown_as_item=d(t.pic_shown_as_item,!1),this.image_class=d(t.image_class,""),this.index=d(t.index,0),this.children=t.children||{}}function PicLayers(e,t,n){this.pic=e,this.cont=t,this.onload=n,this.reverseX=!1,this.reverseY=!1,this.image_class=d(e.image_class,""),this.othercls="",this.offset=[0,0],this.gravity_coef=1,this.offset_prop={grid:null,val:[0,0],unit:["%","%"],prop:["left","bottom"],range:[[0,100],[0,100]]}}function PlatformGrid(e,t){var n=(t[0][1]-t[0][0])/e[0].length,o=(t[1][1]-t[1][0])/e.length;this.matrix=e,this.x=n,this.y=o,this.range=t}function getObjUID(e){return cntUp(global_uid,e,0),e.substr(0,4)+global_uid[e]}function File(e,t,n){n=n||{},this.executable=d(n.executable,!1),this.readable=d(n.readable,!0),this.writable=d(n.writable,!1),this.picture=new Pic(t,n),this.cmd_event={},this.cmd_text={},this.name=e,this.uid=n.uid||getObjUID(n.poid||e),this.poprefix=n.poprefix,EventTarget.call(this)}function Item(e,t,n,o){o=o||{},o.poprefix=d(o.poprefix,POPREFIX_ITEM),File.call(this,e,n,o),this.cmd_text={less:t?t:_(PO_DEFAULT_ITEM)},this.room=null,o.poid&&this.setPo(o.poid,o.povars)}function People(e,t,n,o){o=o||{},o.poprefix=d(o.poprefix,POPREFIX_PEOPLE),Item.call(this,e,t,n,o),this.people=!0}function Room(e,t,n,o){o=o||{},o.executable=d(o.executable,!0),File.call(this,d(e,_(PO_DEFAULT_ROOM,[])),n,o),this.parents=[],this.previous=this,this.children=[],this.items=[],this.isRoot=!0,this.intro_text=d(t,_(PO_DEFAULT_ROOM_DESC)),this.starter_msg=null,this.enter_callback=null,this.leave_callback=null,this.suggestions=[]}function newRoom(e,t,n){var o=POPREFIX_ROOM+e,r=new Room(_(o,[],{or:PO_DEFAULT_ROOM}),_(o+POSUFFIX_DESC,[],{or:PO_DEFAULT_ROOM_DESC}),t,n);return r.varname="$"+e,r.poid=o,r.picture.setImgClass(r.varname.replace("$","room-")),window[r.varname]=r,r}function enterRoom(e,t){var n=t.getContext();return!n&&e.hasParent(n)||n.doLeaveCallbackTo(e),t.setContext(e),state.setCurrentRoom(e),"function"==typeof e.enter_callback&&e.enter_callback(e,t),[e.toString(),e.intro_text]}function app_loaded(){start_game()}function getTime(){var e=new Date;return e.getHours()+"h"+e.getMinutes()}function learn(e,t,n){"string"==typeof t&&(t=[t]),n||global_fireables.done.push(function(){for(var n=0;n<t.length;n++)e.badge(_("you_learn",[t[n]]),_("you_learn_desc",[t[n]])),e.playSound("learned")})}function unlock(e,t,n){n||global_fireables.done.push(function(){e.playSound("unlocked"),e.badge(_("you_unlock",[t]),_("you_unlock_desc",[t]))})}function mesg(e,t,n){if(!t){n=n||{};var o=function(){setTimeout(function(){vt.show_msg('<div class="mesg">'+_("msg_from",[n.user||"????",n.tty||"???",getTime()])+"\n"+e+"</div>",{direct:!0})},n.timeout||0)};n.ondone?global_fireables.done.push(o):o()}}function ondone(e){global_fireables.done.push(e)}function success(e,t,n){n||global_fireables.done.push(function(){e.playSound("success"),e.badge(_(t+"_success_title"),_(t+"_success_text"));var n=t+"_congrat_mesg";n in dialog&&mesg(_(n))})}function start_game(){var e=state.startCookie(cookie_version),t=[_("cookie_yes"),_("cookie_no")];e&&t.unshift(_("cookie_yes_load"));var n=function(t,n){t.muteSound();var o=!1;if(pogencnt>0&&t.show_msg(_("pogen_alert",pogencnt)),n-(e?1:0)<=0?(state.setCookieDuration(10080),0==n&&(o=state.loadCookie())):state.stopCookie(),t.clear(),t.setContext(state.getCurrentRoom()),o)t.unmuteSound(),t.notification(_("game_loaded")),t.show_msg(t.context.getStarterMsg(_("welcome_msg",[user.name])+"\n")),t.enable_input();else{t.muteCommandResult(),music.play("preload");var r=new Seq;r.then(function(e){t.unmuteSound(),t.ask(_("prelude_text"),function(e){user.judged=_("user_judged-"+Math.min(5,Math.round(e.length/20)))},{cls:"mystory",disappear:function(t){t(),e()}})}),r.then(function(e){t.ask(user.judged+"\n"+_("username_prompt"),function(t){_setUserName(t),e()},{placeholder:user.name,cls:"megaprompt",disappear:function(e){e()},wait:500})}),r.then(function(e){t.ask(_("useraddress_prompt"),function(t){_setUserAddress(t),e()},{placeholder:user.address,cls:"megaprompt",disappear:function(e){e(),t.flash(0,800)},wait:500})}),r.then(function(e){t.muteSound(),t.show_loading_element_in_msg(["_"," "],{duration:800,finalvalue:" ",callback:e})}),r.then(function(e){t.show_msg([_("gameintro_text_initrd"),e],{})}),r.then(function(e){loadel=dom.Id("initload"),t.show_loading_element_in_msg(["/'","'-"," ,","- "],{el:loadel,finalvalue:"<span class='color-ok'>"+_("gameintro_ok")+"</span>",duration:800,callback:e})}),r.then(function(e){t.show_msg([_("gameintro_text_domainname"),e])}),r.then(function(e){loadel=dom.Id("domainsetup"),t.show_loading_element_in_msg(["/'","'-"," ,","- "],{el:loadel,finalvalue:"<span class='color-ok'>"+_("gameintro_ok")+"</span>",duration:800,callback:e})}),r.then(function(e){t.show_msg([_("gameintro_text_fsck"),e])}),r.then(function(e){loadel=dom.Id("initfsck"),t.show_loading_element_in_msg(["/'","'-"," ,","- "],{el:loadel,finalvalue:"<span class='color-pass'>"+_("gameintro_pass")+"</span>",duration:800,callback:e})}),r.then(function(e){t.show_msg([_("gameintro_text_terminus"),e])}),r.then(function(e){t.show_msg(_("gamestart_text")),t.unmuteSound(),music.play("story"),t.enable_input(),t.auto_shuffle_input_msg(_("press_enter"),.9,.1,8,20,null,50)}),r.next()}};vt=new VTerm("term"),vt.soundbank=snd,vt.charduration=20,vt.charfactor[" "]=25,vt.disable_input(),_addGroup("cat"),_addGroup("dir"),vt.flash(0,800),vt.epic_img_enter("titlescreen.gif","epicfromright",800,function(e){e.show_msg(["version : "+game_version,null]),TESTING?(e.enable_input(),e.setContext(state.getCurrentRoom()),do_test()):e.ask_choose(_("cookie"),t,n,{direct:!0})})}function cat_first_try(e){$home.unsetCmdEvent("less_no_arg"),mesg(_("cmd_cat_first_try"),e,{timeout:500})}function cat_second_try(e){$home.unsetCmdEvent("destination_unreachable"),mesg(_("cmd_cat_second_try"),e,{timeout:1e3})}function shell_dial(e){isStr(shell_txt_id)||(2==shell_txt_id&&pwddecl.fire_event(vt,"less"),shelly.setTextIdx(++shell_txt_id%7)),state.saveCookie()}function mv_sum(e){mv_pr_sum++,3==mv_pr_sum&&(prof.moveTo($academy_practice),$spell_casting_academy.removePath($lessons),$spell_casting_academy.setEnterCallback(null),e?$western_forest.removePath($spell_casting_academy):$spell_casting_academy.setLeaveCallback(function(){$western_forest.removePath($spell_casting_academy)}),e||(success(vt,"room_spell_casting_academy",e),ondone(function(){setTimeout(function(){snd.play("broken")},1e3),setTimeout(function(){prof.setTextIdx("quit"),music.play("warning",{loop:!0}),mesg(_("leave_academy"),e)},3e3)}))),console.log("mv",mv_pr_sum)}function poney_dial(e){isStr(poney_txt_id)||(poney.setTextIdx(poney_txt_id++),5==poney_txt_id&&poney.setCmdEvent("less_done","uptxthint"))}function poney_dialhint(e){poney.setCmdEvent("less_done","uptxthint"),vt.statkey.Tab&&0!=vt.statkey.Tab?_hasGroup("mv")?state.applied("mvBoulder")?poney.setTextIdx("help"):poney.setTextIdx("mountain"):poney.setTextIdx("mv"):poney.setTextIdx("tab")}function buy_to_vendor(e,t){return 0==t?$market.hasItem("mkdir_cost")?($market.removeItem("mkdir_cost"),$market.apply("mkdirSold"),_("you_buy",[_("item_mkdir_spell")])):_("need_money",[_("item_rm_spell")]):1==t?$market.hasItem("rm_cost")?($market.removeItem("rm_cost"),$market.apply("rmSold"),_("you_buy",[_("item_rm_spell")])):_("need_money",[_("rm_cost")]):void 0}var dialog={pogen_alert:"%s translations are missing, type 'pogen' to download the translation file.",gamestart_text:'Welcome! If you are new to the game, here are some tips: \n\nLook at your surroundings with the command "ls". \nMove to a new location with the command "cd LOCATION" \nYou can backtrack with the command "cd ..". \nInteract with things in the world with the command "less ITEM" \n\nIf you forget where you are, type "pwd" \n\nGo ahead, explore. We hope you enjoy what you find. Do ls as your first command.',cookie:"In order to save/restore the game, you need eat cookies.\nDo you want to activate cookies ?",yes:"yes",no:"no",cannot_cast:"You cannot cast this spell here.",cmd_cd:"You have moved to %s. %s",cmd_cd_failed:"There is no room called %s.",cmd_cd_no_args:"'cd ~' to come back on start point.\n 'pwd' to know where you are.",cmd_cd_flood:"You can't move to multiple locations.",cmd_cd_home:"You have come Home !",cmd_cd_no_parent:"You are at the first room %s.",cmd_cd_parent:"You have moved to %s. %s",cmd_cp_copied:"Just copied %s into %s.",cmd_cp_unknown:"No item of that name to copy.",tgt_already_exists:"Item '%s' already exists.",item_not_exists:"Item '%s' not exists.",cmd_help_suggestion:"Type 'man' to ask the man for help.",cmd_less_invalid:"Pick a different item to less.",cmd_less_missing:"There is no %s here.",cmd_man_no_query:"Must ask the man about something to receive a response.",cmd_man_not_found:"There is no man page for that command.",cmd_not_found:"Command '%s' not found in room '%s'.",cmd_mv_done:"Moved %s to %s.",cmd_mv_flood:"You need to move thing A to place B. Use mv [thingA] [placeB].",cmd_mv_invalid:"Must be a valid item and location to move it.",cmd_mv_fixed:"This can't be moved.",cmd_pwd:"You are in %s.",cmd_rm_done:"You just removed %s ",cmd_rm_failed:"That item cannot be removed",cmd_rm_invalid:"That's not a valid object to remove.",cmd_rm_miss:"You must remove a particular item.",cmd_touch_created:"You have just created %s",cmd_touch_none:"You haven't touched anything. Check your syntax.",cmd_touch_nothing:"You must touch something in particular.",cmd_unknown:"You haven't learned this spell yet.",combo:"The combination is 'terminus' (without the quotes).",directions:"Locations:\n%s ",incorrect_syntax:"Incorrect syntax. Ask the OldMan for help.",invalid_locker:"No valid locker of that name.",invalid_spell:"This is not a valid spell.",items:"Objects:\n%s",peoples:"Peoples:\n%s",room_empty:"The room is empty.",room_new_created:"New room %s created",room_none:"GenericRoom",room_none_text:"This is a generic room.",item_none:"GenericItem",item_none_text:"This is a generic item.",item_intro:"This is a %s.",people_none:"SomePeople",people_none_text:"This person seems to be a bot.",room_wrong_password:"Wrong password.",room_wrong_syntax:"Wrong syntax. Read the instructions again.",cmd_exit:"Good Bye !",cmd_exit_html:"<p>Terminus is stopped.</p><p>Good Bye !</p>",room_home:"Home",room_home_text:"This is a beautiful green meadow. A plump but majestic pony prances happily about.",room_western_forest:"WesternForest",room_western_forest_text:"You enter and travel deep into the forest. Eventually, the path leads to a clearing with a large impressive building.\nA sign on it reads: Spell Casting Academy: The Elite School of Magic.",room_spell_casting_academy:"SpellCastingAcademy",room_spell_casting_academy_text:"The halls are filled the hustle and bustle of academy students scurrying to and from classes.\nThe inside of the  academy is as impressive as it is on the outside with a high ceiling and gothic \narches, it seems even larger on the inside.",item_western_forest_academy_direction:"Sign",item_western_forest_academy_direction_text:"Spell Casting Academy: The Elite School of Magic\nToday Only: Free Introductory Lessons! Novices welcome!",item_western_forest_back_direction:"BackSign",item_western_forest_back_direction_text:"If you ever want to go directly Home, just type 'cd ~' or just plain old `cd' and you'll come back Home.\nGetting back might be more difficult though.",item_welcome_letter:"WelcomeLetter",item_welcome_letter_text:'Welcome! If you are new to the game, here are some tips: \n\nLook at your surroundings with the command "ls". \nMove to a new location with the command "cd LOCATION" \nYou can backtrack with the command "cd ..". \nInteract with things in the world with the command "less ITEM" \n\nIf you forget where you are, type "pwd" \n\nGo ahead, explore. We hope you enjoy what you find. Do ls as your first command.',item_practice_dummy:"PracticeDummy%d",item_practice_dummy_text:"It's a practice_dummy",room_academy_practice:"PracticeRoom",room_academy_practice_text:"The room is filled with practice dummies for students to practice their new spells on.",item_academy_practice:"Instructions",item_academy_practice_text:"Welcome to the Practice Room. Here you will find practice dummies \ntry your new spells on. Go ahead, give it a go! ",room_box:"Box",room_box_text:"This box is too small for you to fit into.",room_box_cd:"You are too small to fit into the box.",room_meadow:"NorthernMeadow",room_meadow_text:"This is a beautiful green meadow. A plump but majestic pony prances happily about.",people_poney:"Pony",people_poney_text:"You go up to the pony and attempt to ride it.\nIt compiles and you ride the pony around in circles for a bit.\nHe then grows tired of having you as a burden and knocks you off.\nHe then looks towards the east as if suggesting that you head in that direction.",people_academy_student:"HurryingStudent",people_academy_student_text:"You speak to a hurrying student.\nThe student runs into you and falls to the ground.\nThe student quickly gets up and apologizes to you, asking if you are okay.\nYou are sturdier than you look and  you're undamaged.\nI'm so sorry, I was in such a hurry that I didn't see you  there...\n\"Say, I haven't seen you here before. You're new here aren't-cha? \"\nthe  student winks at you,\n\"Don't worry, there's tons of newbies around today, \nwhy don't you try checking out one of the free intro lessons? I'd show you where \nto go, but I gotta run to class. Just head into the Lessons hall and someone \nshould help you out. See you around.\"\nThe student runs past you. You notice that the student is pretty cute, and probably around your age.\nUnfortunately, the student disappears around a corner before you can ask for a name.",room_mountain:"EasternMountains",room_mountain_text:"You travel through a mountain path, which eventually leads you to the entrance of a cave.\nSitting right outside this cave is an old man.",people_man_sage:"OldMan",people_man_sage_text:'You speak with the old man. He greets you warmly as if you were old friends. You feel at ease with him. \n"Hello adventurer! \nTop of the morning to you! You seem like a young and energetic explorer.\nIf you\'re brave enough, your destiny awaits within this cave. That \ndestiny will manifest itself as a portal.\nEnter this portal and begin the next chapter of your life."\nThe old man sees the shock on your face and smiles a comforting smile, \n"I am but a fragile old man, and cannot accompany you through this cave,\nbut what I can provide are a few simple spells that will help you \nalong your way. Just read my old manuscripts and tryout those spells."',item_man:"OldManuscripts",item_man_text:'If you ever forget a spell just use "help"\nand a list of available spells will appear. If you need details on how \nto use a specific spell, use \'man\' followed by spell command. For example, \nif you were interested in details on how to use the "mv" spell you would use : man mv',room_lessons:"Lessons",room_lessons_text:'You enter the Lessons hall ready and eager. \nIt\'s much quieter here, as many of the lessons have already started. \nYou quickly ushered into the Introductory Lesson, which already begun. \nYou enter the class on the "Move Spell."',people_professor:"Professor",people_professor_text:"The professor is difficult to understand,\nbut you pick up just enough to learn 3 things: \n1. You can use 'mv' to move things in the world \n2. You have to indicate the object and the new location (i.e.: mv OBJECT NEWLOCATION) \n3. This spell will only work on certain objects, for example the PracticeDummy objects in the PracticeRoom \n\nYou did not pay enough attention to learn which types of objects are unmovable. \nOh well, experimenting was always more of your style anyways. But be careful!",room_cave:"Cave",room_cave_text:"It's your typical cave: dark and dank.",room_dark_corridor:"DarkCorridor",room_dark_corridor_text:"You travel through the dark corridor and find a small dank room at the end.",room_staircase:"Staircase",room_staircase_text:"The rocky staircase leads you to a dead end and a sign indicating such.",item_dead_end:"Sign",item_dead_end_text:"DEAD END",room_dank:"DankRoom",room_dank_text:"It's a musty dank room. A round boulder sits to the right side of the room.",item_boulder:"Boulder",item_boulder_text:"You feel a slight breeze coming from behind the boulder. Maybe move it out of your way?",room_small_hole:"SmallHole",room_small_hole_text:"There's nothing exciting in the small hole, and it's pretty dirty. \nThere's no real reason to go into the hole.",room_small_hole_cd:"There's nothing exciting in the small hole, and it's pretty dirty. \nI suggest going back out.",room_tunnel:"Tunnel",room_tunnel_text:"It's quite moist in here. \nYou notice a small furry movement in the corner of your vision. \nIt's most likely a rat. A very large rat. Perhaps a mongoose. \nAt the end of the tunnel you find a stone chamber.",people_rat:"Rat",people_rat_text:"Upon further inspection, you determine that the furry \npresence is in fact a rat...the size of a small dog. He or She bites you. \nYou are very displeased.",room_stone_chamber:"StoneChamber",room_stone_chamber_text:"The whole rooms glows a dim green light. \nThe source of this light is a portal standing in the middle of the room. \nThis is obviously the portal of which the old man spoke.",room_portal:"Portal",room_portal_text:"You have been transported through time...",room_townsquare:"TownSquare",room_townsquare_text:"You are in a sunny and spacious town square. \nThere is a pedestal at the center of the cobblestone turnabout, but no statue on it. \nThe architecture is charming, but everyone here seems nervous for some reason.",people_citizen1:"RandomCitizen1",people_citizen1_text:'"Excuse me," you begin. The man turns, startled. \n"Oh, hello! Welcome to Terminus. You\'ll have to forgive me, but we\'re all \na little on edge lately, what with the Dark Wizard spreading corruption \nall along the coast.  You should be careful!"',people_citizen2:"RandomCitizen2",people_citizen2_text:'The man looks up from his newspaper when he notices you staring. \n"Have you read this?" he exclaims, shaking the latest edition \nof "The Last Word" in your face.\n"It says here the wizard\'s corruption has spread as far \nas Oston to the south, and New Console is completely unrecoverable!\nThese are dangerous times," he mutters, shaking his head and \nturning back to his reading.',people_citizen3:"DistraughtLady",people_citizen3_text:'The woman is sobbing uncontrollably, her face in her hands. \n"My baby," she cries, "They kidnapped my baby! I just \nknow that wizard had something to do with it."',room_market:"Marketplace",room_market_text:"Vendors and their goods line the streets.",people_vendor:"Vendor",people_vendor_text:'" \'Ello there." The vendor smiles at you unpleasantly, \nrevealing a mouth full of gold teeth. "Well? Wot are you looking for?"',people_vendor_rm:'"Ha! That spell doesn\'t work on everything, you know.\nI may have forgotten to mention that before I sold it to you..."',item_rm_spell:"rmSpell",item_rm_spell_text:'"Ah, yes, the rm spell," the Vendor muses. \n"Simply say "rm" followed by the name of an item or person, \nand they will disappear from this plane... forever. \nD\'you have the guts to use it, I wonder?"',item_backpack:"Backpack",item_backpack_text:"There's a beat-up looking backpack on the \ntable with no price tag.  Its cloth looks frayed, but sturdy.\nYou glance quickly at the vendor, but his attention is elsewhere. \nMaybe you can move it in your home ...",item_backpack_stolen:"You just stole the backpack. \nGiven you have no job in a big coorporation, \nRichard Stallman shall be proud of you.",item_mkdir_spell:"mkdirSpell",item_mkdir_spell_text:'"Make dreams into reality. Just say "mkdir" followed by any name that\npleases you, and you can create a new place that never existed there before.\nA little finicky, though..." the Vendor mumbles.',room_library:"Library",room_library_text:"The Library is dimly lit and smells like mildew. \nStill, it's warm in here and the soft green carpet makes it seem kind of cozy.",item_radspellbook:"TotallyRadSpellbook",item_radspellbook_text:'Legends speak of a great word of power that allows the speaker to perform \nany action on any item. "Sudo", as the ancients called it, \nconveys complete mastery over the elements. \nUnfortunately, or perhaps fortunately, the mystical password has been lost \nto the sands of time.',item_romancebook:"PaperbackRomance",item_romancebook_text:'You flip the paperback open to a random page. \n"Oh, Horatio!" Antonia exclaimed, her bosom heaving as Horatio deftly ripped \n the bodice from her lithe frame. Horatio gave an animalistic growl and\nhe clasped her fingers in his strong hands and brought them to rest upon ...\n— You close the book, disinterested, and place it back on the shelf.',item_historybook:"HistoryOfTerminus",item_historybook_text:"It looks like an interesting book, but it's way too long and \nthe print is too tiny. Here is an excerpt:\n \nDarkWizard ...old tales tell of a DarkWizard who will fragment the land...\n...only the world-maker can stop the DarkWizard's virus from...\n...that the power of \"sudo\" may be the DarkWizard's only weakness...",item_nostalgicbook:"NostalgiaForHome",item_nostalgicbook_text:"The book says : \"If you ever get lonely for Home,\njust 'cd ~' and you'll go back there. \nBut just remember that it will be harder to come back.\"\n\n Later in the book, a story about loneliness says that \na Wizard with a rainbow pullover pink glasses,\nwas known to do instant movement from home to distant places.\nThe next page seems to explain how to, but it is torn apart.",item_vimbook:"VIMproved",item_vimbook_text:"While you open this book, a glow illuminates your eyes. \nYou've been blind for some seconds and the book disappear.",item_lever:"InconspicuousLever",item_lever_text:"You spot an inconspicuous lever behind the shelves.\nCurious, you pull it, and a panel slides open to reveal a secret back room.",room_backroom:"BackRoom",room_backroom_text:"You find a mysterious back room.\nYou find a librarian alone with a small elf.\nYou hope you're not interrupting.",people_grep:"Grep",people_grep_text:'The exceptionally ugly elf turns to you with a sour expression. \n"Greeeeeep," he says sullenly.',item_practicebook:"PracticeBook",item_practicebook_text:"Sally picked a peck\nOf seashelled peppers.\nA seashore of pickled pickles\ndid Peter and Sally pick.",people_librarian:"Librarian",people_librarian_text:'"Hm? Oh, hello. I apologize for the mess,\nbut I\'m very busy doing research on the dark wizard.\nWould you do me a favor? Go look up all references to DarkWizard in \nthe History of Terminus. My assistant Grep can help you." \nGrep eyes you balefully. "Greeepp."\n"To search the contents of the book, just type "grep PHRASE ITEM",\nwhere PHRASE is the phrase you want to search for, \nand ITEM is the name of the book you want to search.\nTry it with the PracticeBook here \n  - see if you can find the line with the word \'peppers\' in it."',

room_rockypath:"RockyPath",room_rockypath_text:"The weed-choked path leads off into the fields.",item_largeboulder:"LargeBoulder",item_largeboulder_text:"There is an enormous boulder blocking your way.\nIt's much too big to move.",item_largeboulder_rm:"The boulder disappears with a pop.",room_artisanshop:"ArtisanShop",room_artisanshop_text:"The walls of the shop are covered in clocks, all slightly out of sync.\nAt the workbench, a woman in an enormous pair of goggles \nis wielding a blowtorch with frightening enthusiasm.",item_strangetrinket:"StrangeTrinket",item_strangetrinket_text:"It looks like a crystal of some sort. It's very beautiful.",item_strangetrinket_rm:"Didn't your mother ever teach you that it's rude to rease other people's \nthings from their plane of existence?",item_strangetrinket_mv:"You can't take that, it's not yours!",item_dragon:"ClockworkDragon",item_dragon_text:"A dragon the size of a small dog is frolicking about the room. \nYou'd think it was real if it weren't for the wind-up key sticking out of its back.",item_dragon_rm:"Didn't your mother ever teach you that it's rude to erase other people's \nthings from their plane of existence?",item_dragon_mv:"You can't take that, it's not yours!",people_artisan:"Artisan",people_artisan_text:"The Artisan lifts up her goggles and peers at you in surprise. \n\"Are you the new assistant? You're late! ...  \nYou say you aren't my assistant? \nWell, that doesn't mean you can't make yourself useful.\nI need some gears, quickly! \n... \nYou don't even know how to make things? Hmph. Some assistant you are.\nJust say \"touch ITEM\" alright?\nWhere ITEM is the name of the thing you want to create. Now make me a Gear! Then come back.\"",item_gear:"gear%s",item_gear_artisans_ok:"Ha, finished already? I guess you learn fast.\nWell, thanks for your assistance.",item_gear_text:"This is a Gear",item_gear_touch:"Well that’s lovely, thank you, but you can’t expect me to make\nanything with just one gear! Can’t you copy it?\n...\n*sigh* I can see you are going to need a lot of training. Just say “cp [ITEM] [NEWITEM]”.\n[ITEM]’s the name of the item that you want copy, and [NEWITEM]’s the new name of the\ncopy, got it? Then poof! You’ll have shiny new item. I need five more gears so you’d better\nget started! Just call them gear1, gear2, gear3, gear4, and gear5, please.",room_farm:"Farm",room_farm_text:"There was once a farm of some sort here,\nbut now the fields are scorched and brown.",item_earofcorn:"EarOfCorn",item_earofcorn_text:"The corn is sad and withered-looking.",item_earofcorn_rm:"Why would you destroy a starving man's only food?",item_another_earofcorn:"AnotherEarOfCorn",item_another_earofcorn_text:"This is AnotherEarOfCorn",corn_farmer_ok:"It’s a miracle! Thank you, friend. May the Admin bless you.",people_farmer:"Farmer",people_farmer_text:"\"Ruined! I'm ruined! Look at these crops... almost nothing left!\nThe wizard's minions were here last week... they destroyed everything.\nHow will I feed my 3 children with just one ear of corn?\nI could really use {{item_another_earofcorn}}! \"",room_clearing:"Clearing",room_clearing_text:"There's a small grassy clearing here, with a man sitting on a stone, weeping.\nBehind him is a pile of rubble.",room_clearing_cd:" You can’t cross the bridge until you’ve replaced the missing Plank. ",people_cryingman:"CryingMan",people_cryingman_text:"\"You! You're a magic-user! I can tell, you've got that look. \nCome to finish the job, have you?\nWell, go ahead, do your worst there's nothing else you can take from me.\nNot since the rest of you were here a few days ago.\" \n\n\"What happened? You DARE to ask-- you know perfectly well what happened. \nYour friends, the wizard's minions, destroyed my house and kidnapped my \npoor daughter, that's what! My wife even went into town to look for help, \nand I haven't heard from her since!\" \n\n\"Hm? Well, I guess it's true that you don't look like one of the wizard's minions.\nStill, I don't trust you magicfolk. \nIf you really are who you say you are, then prove your good intentions \nby making me a new {{room_house}}!\"",room_house:"House",room_house_text:"This is a {{room_house}}",room_house_cd:"You are entering the {{room_house}} that you made.",room_house_ls:"You made this house for the man. How thoughtful of you!",room_clearing_less2:"Thank you for making me the {{room_house}}!  Why am I still crying?  These are tears of joy.  Can't a man openly express his emotions?",room_clearing_text2:"There's a small grassy clearing here, with a man sitting on a \n stone, weeping. Behind him is a pile of rubble and a small white house.",room_brokenbridge:"BrokenBridge",room_brokenbridge_text:"A creaky wooden bridges stretches across a chasm.\nBut it's missing a {{item_plank}}, and the gap is too far to jump.",room_brokenbridge_text2:"A creaky rope bridges stretches across a chasm.",item_plank:"Plank",item_plank_text:"This is a Plank.",room_ominouspath:"OminousLookingPath",room_ominouspath_text:"The path leads toward a dark cave. It's an ordinary cobblestone path, but for \nsome reason it fills you with a sense of dread.",item_brambles:"ThornyBrambles",item_brambles_text:"This thicket of brambles is covered with wicked-looking thorns. You can't go around it, and you definitely aren't about to go through it. And yet something tells you that you really want to.",item_brambles_mv:"You can't touch them because they are covered with thorns. Ouch!",item_brambles_rm:"You speak the words of the Remove spell and the brambles glimmer a \ndeep blue. After fizzling for a minute, they disappear with a puff of smoke.",room_slide:"Slide",room_slide_text:"The slides is long. At the end, you see the KernelFiles.",room_slide_cd:"You have to get past the UglyTroll first.",room_slide_cd2:"It's just a Slide. Keep going. You're almost at the KernelFiles.",room_kernel:"KernelFiles",room_kernel_text:"The KernelFiles hold the sudo-secret (no, not pseudo). You'd better read the Instructions.",ask_password:"Password:",room_kernel_IHTFP:"You have correctly entered the password. You are now in Paradise. Take a look around, and congratulations.",item_certificate:"Certificate",item_certificate_text:"You must read the Certificate with the sudo password.",item_instructions:"Instructions",item_instructions_text:"You've learned how to make use of your friend grep I see. If you haven't it might be wise for you to go back to the Library again to do some reading. Because here, you'll need to use him to help you. Here is your task: \nThere are a lot of items in the MoreKernelFiles room and one of them contains the sudo password. This password is very powerful password that lets you do absolutely anything in the world. It lets you cast a spell on any item that is protected in any way. You know the password is contained in one of these .txt items. You know that it appears on a line that says the word: 'password='. You should find it with grep's help. Then you'll need to use the sudo spell to find Paradise. To do this, just Type 'sudo' before the command you want to run, like so: 'sudo cp ITEM_A ITEM_B'. You will then be prompted for the sudo password. Type the password, and the spell that comes after sudo will be cast. If you open the Certificate in Paradise with sudo, you will have truly found Paradise.",room_morekernel:"MoreKernelFiles",room_morekernel_text:"There are so many files here!",item_bigfile:"%s_txt",item_bigfile_text:"Alice was beginning to get very tired of sitting by her \nsister on the bank, and of having nothing to do: once or twice she had peeped into the \nbook her sister was reading, but it had no pictures or conversations in it, 'and what is \nthe use of a book,' thought Alice 'without pictures or conversation?' \n\nSo she was considering in her own mind (as well as she could, for the hot day \nmade her feel very sleepy and stupid), whether the pleasure of making a \ndaisy-chain would be worth the trouble of getting up and picking the daisies, \nwhen suddenly a White Rabbit with pink eyes ran close by her.\n\nThere was nothing so VERY remarkable in that; nor did Alice think it \nso VERY much out of the way to hear the Rabbit say to itself, \n'Oh dear! Oh dear! I shall be late!' (when she thought it over afterwards, \nit occurred to her that she ought to have wondered at this, but at the \ntime it all seemed quite natural); but when the Rabbit actually TOOK A \nWATCH OUT OF ITS WAISTCOAT-POCKET, and looked at it, and then hurried on, \nAlice started to her feet, for it flashed across her mind that she had \nnever before seen a rabbit with either a waistcoat-pocket, or a watch \nto take out of it, and burning with curiosity, she ran across the \nfield after it, and fortunately was just in time to see it pop down \na large rabbit-hole under the hedge. \n\nIn another moment down went Alice after it, never once considering how \nin the world she was to get out again. \n\nThe rabbit-hole went straight on like a tunnel for some way, and then \ndipped suddenly down, so suddenly that Alice had not a moment to think \nabout stopping herself before she found herself falling down a very deep well.\n\nEither the well was very deep, or she fell very slowly, for she had \nplenty of time as she went down to look about her and to wonder what \nwas going to happen next. First, she tried to look down and make out what \nshe was coming to, but it was too dark to see anything; then she looked at \nthe sides of the well, and noticed that they were filled with cupboards and \nbook-shelves; here and there she saw maps and pictures hung upon pegs. She \ntook down a jar from one of the shelves as she passed; it was labelled \n'ORANGE MARMALADE', but to her great disappointment it was empty: she did \nnot like to drop the jar for fear of killing somebody, so managed to put it \ninto one of the cupboards as she fell past it. \n\n'Well!' thought Alice to herself, 'after such a fall as this, I shall \nthink nothing of tumbling down stairs! How brave they'll all think me \nat home! Why, I wouldn't say anything about it, even if I fell off the \ntop of the house!' (Which was very likely true.)\n\nDown, down, down. Would the fall NEVER come to an end! 'I wonder how \nmany miles I've fallen by this time?' she said aloud. 'I must be getting \nsomewhere near the centre of the earth. Let me see: that would be four \nthousand miles down, I think—' (for, you see, Alice had learnt several \nthings of this sort in her lessons in the schoolroom, and though this \nwas not a VERY good opportunity for showing off her knowledge, as \nthere was no one to listen to her, still it was good practice to say it \nover) '—yes, that's about the right distance—but then I wonder what \nLatitude or Longitude I've got to?' (Alice had no idea what Latitude was, \nor Longitude either, but thought they were nice grand words to say.)\n\nPresently she began again. 'I wonder if I shall fall right THROUGH the \nearth! How funny it'll seem to come out among the people that walk with \ntheir heads downward! The Antipathies, I think—' (she was rather glad \nthere WAS no one listening, this time, as it didn't sound at all the \nright word) '—but I shall have to ask them what the name of the country is, \nyou know. Please, Ma'am, is this New Zealand or Australia?' (and she \ntried to curtsey as she spoke—fancy CURTSEYING as you're falling through \nthe air! Do you think you could manage it?) 'And what an ignorant little \ngirl she'll think me for asking! No, it'll never do to ask: perhaps I \nshall see it written up somewhere.' \n\nDown, down, down. There was nothing else to do, so Alice soon began \ntalking again. 'Dinah'll miss me very much to-night, I should think!' \n(Dinah was the cat.) 'I hope they'll remember her saucer of milk at \ntea-time. Dinah my dear! I wish you were down here with me! There are \nno mice in the air, I'm afraid, but you might catch a bat, and that's \nvery like a mouse, you know. But do cats eat bats, I wonder?' And here \nAlice began to get rather sleepy, and went on saying to herself, in a \ndreamy sort of way, 'Do cats eat bats? Do cats eat bats?' and sometimes, \n'Do bats eat cats?' for, you see, as she couldn't answer either question, \nit didn't much matter which way she put it. She felt that she was \ndozing off, and had just begun to dream that she was walking hand \nin hand with Dinah, and saying to her very earnestly, 'Now, Dinah, \ntell me the truth: did you ever eat a bat?' when suddenly, thump! \nthump! down she came upon a heap of sticks and dry leaves, and the \nfall was over.\n\nAlice was not a bit hurt, and she jumped up on to her feet in a moment: \nshe looked up, but it was all dark overhead; before her was another \nlong passage, and the White Rabbit was still in sight, hurrying down \nit. There was not a moment to be lost: away went Alice like the wind, \nand was just in time to hear it say, as it turned a corner, 'Oh my \nears and whiskers, how late it's getting!' She was close behind it \nwhen she turned the corner, but the Rabbit was no longer to be seen: \nshe found herself in a long, low hall, which was lit up by a row \nof lamps hanging from the roof. \n\nThere were doors all round the hall, but they were all locked; \nand when Alice had been all the way down one side and up the other, \ntrying every door, she walked sadly down the middle, wondering how \nshe was ever to get out again.\n\nSuddenly she came upon a little three-legged table, all made of \nsolid glass; there was nothing on it except a tiny golden key, and \nAlice's first thought was that it might belong to one of the doors \nof the hall; but, alas! either the locks were too large, or the \nkey was too small, but at any rate it would not open any of them. \nHowever, on the second time round, she came upon a low curtain she \nhad not noticed before, and behind it was a little door about fifteen \ninches high: she tried the little golden key in the lock, and to her \ngreat delight it fitted! \n\nAlice opened the door and found that it led into a small passage, not \nmuch larger than a rat-hole: she knelt down and looked along the \npassage into the loveliest garden you ever saw. How she longed to \nget out of that dark hall, and wander about among those beds of bright \nflowers and those cool fountains, but she could not even get her head \nthrough the doorway; 'and even if my head would go through,' thought \npoor Alice, 'it would be of very little use without my shoulders. Oh, \nhow I wish I could shut up like a telescope! I think I could, if I \nonly know how to begin.' For, you see, so many out-of-the-way things \nhad happened lately, that Alice had begun to think that very few \nthings indeed were really impossible. \n\nThere seemed to be no use in waiting by the little door, so she went \nback to the table, half hoping she might find password=IHTFP another key on it, or at \nany rate a book of rules for shutting people up like telescopes: this \ntime she found a little bottle on it, ('which certainly was not here \nbefore,' said Alice,) and round the neck of the bottle was a paper \nlabel, with the words 'DRINK ME' beautifully printed on it in large \nletters.\n\nIt was all very well to say 'Drink me,' but the wise little Alice was \nnot going to do THAT in a hurry. 'No, I'll look first,' she said, \n'and see whether it's marked \"poison\" or not'; for she had read \nseveral nice little histories about children who had got burnt, \nand eaten up by wild beasts and other unpleasant things, all because \nthey WOULD not remember the simple rules their friends had taught \nthem: such as, that a red-hot poker will burn you if you hold it \ntoo long; and that if you cut your finger VERY deeply with a knife, \nit usually bleeds; and she had never forgotten that, if you drink \nmuch from a bottle marked 'poison,' it is almost certain to \ndisagree with you, sooner or later. \n\nHowever, this bottle was NOT marked 'poison,' so Alice ventured to \ntaste it, and finding it very nice, (it had, in fact, a sort of mixed \nflavour of cherry-tart, custard, pine-apple, roast turkey, toffee, \nand hot buttered toast,) she very soon finished it off.",room_paradise:"Paradise",room_paradise_text:"You have truly found Paradise with the sudo password. \nCongratulations.",room_paradise_ls:"There's really nothing interesting in Paradise.",room_trollcave:"CaveOfDisgruntledTrolls",room_trollcave_text:"The cave is dark and smells like... feet? Oh, right, it's probably the trolls. \nThere's a scared-looking kid in a cage by the far wall.",people_troll1:"UglyTroll",people_troll1_text:"He looks mad, and really ugly.",people_troll1_mv:"The troll looks briefly surprised, then moves away.\nHe's mostly harmless anyway.",people_troll1_rm:"The troll looks briefy surprised, then vanishes \nwith an unpleasant squelching sound.",people_troll1_cp:"They're multiplying!",people_troll2:"UglierTroll",people_troll2_text:"He looks mad, and really, really ugly. \nBut he wants to tell you something. Between his \ngarbled grunts, you manage to understand the following: \nYou can cast spells on items that you don't currently see. For example, if you want \nto copy an item from this room to the OminousLookingPath from which you came, you can \ncp [ITEM_TO_COPY] ../[NEW_ITEM_NAME]. You can do this for most spells and most rooms. \nUse this knowledge wisely. Remember.... you can't undo an 'rm' spell.",people_supertroll:"AbsolutelyHideousTroll",people_supertroll_text:"You probably don't want to look at this guy. Oops, too late.",people_supertroll_rm:"The troll belches spectacularly, and you could swear he actually smirks. You won't get rid of him that easily, not without the 'sudo password'. It's not 'pseudo', it's 'sudo'. You'll find that in KernelFiles. But first you have to get past the UglyTroll to the Slide.",people_supertroll_mv:"If you move him out of the cave, he'll terrorize the countryside.\nAlso he will probably eat you.",room_cage:"Cage",room_cage_text:"There's a scared-looking kid in there.",room_cage_cd:"You can’t squeeze through the bars. Anyway, are you crazy? Why would you want to go into a cage?",people_kidnapped:"KidnappedChild",people_kidnapped_text:"You know it's kind of mean,\nbut you can't help but think that that is one funny-looking kid.",people_kidnapped_mv:"The kid looks around, dazed, surprised to find himself out of the cage. \nYou smile at him and speak in a gentle voice. 'You should probably be getting home, \nlittle boy. Someone is there waiting for you.' \n'I'm a girl,' says the little girl smartly. Then she dashes past you, out of the cave, and \nruns up the ominous path towards home.",man_cd:'The old man\'s voice echoes in your head as if from a great distance: \n(Choose Destination) Use "cd" to move about the world.\nRememberrrrrr...',man_mv:'The old man\'s voice echoes in your head as if from a great distance:\n(MoVe).\nUse "mv" to move an object to a new location. Command Input:" + \nmv OBJECT NEWLOCATION\nRememberrrrrr...',man_ls:'The old man\'s voice echoes in your head as if from a great distance:\n(Look at your Surroundings).\nUse "ls" to look at what’s in a certain location.\nEither your current location or (rarely) you may have look into a location to see\nwhat\'s in it.\n Command Input:\nls          (for current location)\n-OR-\nls LOCATION     (for locations you that you cannot "cd" into)\nRememberrrrrr...',man_less:'The old man\'s voice echoes in your head as if from a great distance:\n(Look at, Examine, or Speak to Something). \nUse "less" to look at what’s in a certain location.\nEither your current location or (rarely) you may have look into a location to see what is in it.\nCommand Input: less ITEM\nRememberrrrrr...',man_man:"I'm the old man dangit! You can't try to get more information about me.\nHere are all the commands you can man: cd, ls, rm, mv, exit, help, man, touch, grep, pwd.",man_help:'Type "man COMMAND" if you forget how to use a command.',man_exit:'The old man\'s voice echoes in your head as if from a great distance:\n(exit)\nUse "exit" to exit the game permanently.\nCommand Input:\nexit\nRememberrrrrr...',"man cp":'The old man\'s voice echoes in your head as if from a great distance:\n(CoPy)\nUse "cp" to duplicate an item.\nCommand Input:\ncp ITEM NEWNAME\nRememberrrrrr...',man_pwd:"The old man's voice echoes in your head as if from a great distance:\n(Print Where i Do stuff)\nTo remind yourself where you currently are.\nCommand Input:\npwd\nRememberrrrrr...",man_grep:'The old man\'s voice echoes in your head as if from a great distance:\n(grep)\nUse "grep" to command your minion to help search through text for you.\nCommand Input: \ngrep WORDTOSEARCH PLACETOSEARCH \nRememberrrrrr...',man_touch:"The old man's voice echoes in your head as if from a great distance:\n(Touch) gives you the artisan's touch to create new objects.\nUse \"touch\" to create new objects in the world.\nCommand Input:\ntouch OBJECT  \nRememberrrrrr..."};!function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var n=this||t;if(e=parseFloat(e),n.ctx||l(),"undefined"!=typeof e&&e>=0&&e<=1){if(n._volume=e,n._muted)return n;n.usingWebAudio&&(n.masterGain.gain.value=e);for(var o=0;o<n._howls.length;o++)if(!n._howls[o]._webAudio)for(var r=n._howls[o]._getSoundIds(),i=0;i<r.length;i++){var a=n._howls[o]._soundById(r[i]);a&&a._node&&(a._node.volume=a._volume*e)}return n}return n._volume},mute:function(e){var n=this||t;n.ctx||l(),n._muted=e,n.usingWebAudio&&(n.masterGain.gain.value=e?0:n._volume);for(var o=0;o<n._howls.length;o++)if(!n._howls[o]._webAudio)for(var r=n._howls[o]._getSoundIds(),i=0;i<r.length;i++){var a=n._howls[o]._soundById(r[i]);a&&a._node&&(a._node.muted=!!e||a._muted)}return n},unload:function(){for(var e=this||t,n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&e.ctx&&"undefined"!=typeof e.ctx.close&&(e.ctx.close(),e.ctx=null,l()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx?e.ctx.state||"running":"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{var n=new Audio;"undefined"==typeof n.oncanplaythrough&&(e._canPlayEvent="canplay")}catch(o){e.noAudio=!0}else e.noAudio=!0;try{var n=new Audio;n.muted&&(e.noAudio=!0)}catch(o){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,n=null;try{n="undefined"!=typeof Audio?new Audio:null}catch(o){return e}if(!n||"function"!=typeof n.canPlayType)return e;var r=n.canPlayType("audio/mpeg;").replace(/^no$/,""),i=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),a=i&&parseInt(i[0].split("/")[1],10)<33;return e._codecs={mp3:!(a||!r&&!n.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!n.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||t,n=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),o=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(n||o)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var r=function(){t._autoResume();var n=e.ctx.createBufferSource();n.buffer=e._scratchBuffer,n.connect(e.ctx.destination),"undefined"==typeof n.start?n.noteOn(0):n.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),n.onended=function(){n.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchend",r,!0)}};return document.addEventListener("touchend",r,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&"undefined"!=typeof e.ctx.suspend&&t.usingWebAudio){for(var n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio)for(var o=0;o<e._howls[n]._sounds.length;o++)if(!e._howls[n]._sounds[o]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&"undefined"!=typeof e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then(function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){var t=this;return e.src&&0!==e.src.length?void t.init(e):void console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var n=this;return t.ctx||l(),n._autoplay=e.autoplay||!1,n._format="string"!=typeof e.format?e.format:[e.format],n._html5=e.html5||!1,n._muted=e.mute||!1,n._loop=e.loop||!1,n._pool=e.pool||5,n._preload="boolean"!=typeof e.preload||e.preload,n._rate=e.rate||1,n._sprite=e.sprite||{},n._src="string"!=typeof e.src?e.src:[e.src],n._volume=void 0!==e.volume?e.volume:1,n._xhrWithCredentials=e.xhrWithCredentials||!1,n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._onend=e.onend?[{fn:e.onend}]:[],n._onfade=e.onfade?[{fn:e.onfade}]:[],n._onload=e.onload?[{fn:e.onload}]:[],n._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],n._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],n._onpause=e.onpause?[{fn:e.onpause}]:[],n._onplay=e.onplay?[{fn:e.onplay}]:[],n._onstop=e.onstop?[{fn:e.onstop}]:[],n._onmute=e.onmute?[{fn:e.onmute}]:[],n._onvolume=e.onvolume?[{fn:e.onvolume}]:[],n._onrate=e.onrate?[{fn:e.onrate}]:[],n._onseek=e.onseek?[{fn:e.onseek}]:[],n._onresume=[],n._webAudio=t.usingWebAudio&&!n._html5,"undefined"!=typeof t.ctx&&t.ctx&&t.mobileAutoEnable&&t._enableMobileAudio(),t._howls.push(n),n._autoplay&&n._queue.push({event:"play",action:function(){n.play()}}),n._preload&&n.load(),n},load:function(){var e=this,n=null;if(t.noAudio)return void e._emit("loaderror",null,"No audio support.");"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var a,s;if(e._format&&e._format[r])a=e._format[r];else{if(s=e._src[r],"string"!=typeof s){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}a=/^data:audio\/([^;,]+);/i.exec(s),a||(a=/\.([^.]+)$/.exec(s.split("?",1)[0])),a&&(a=a[1].toLowerCase())}if(a||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),a&&t.codecs(a)){n=e._src[r];break}}return n?(e._src=n,e._state="loading","https:"===window.location.protocol&&"http:"===n.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&i(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(e,n){var o=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===o._state&&!o._sprite[e])return null;if("undefined"==typeof e){e="__default";for(var i=0,a=0;a<o._sounds.length;a++)o._sounds[a]._paused&&!o._sounds[a]._ended&&(i++,r=o._sounds[a]._id);1===i?e=null:r=null}}var s=r?o._soundById(r):o._inactiveSound();if(!s)return null;if(r&&!e&&(e=s._sprite||"__default"),"loaded"!==o._state){s._sprite=e,s._ended=!1;var d=s._id;return o._queue.push({event:"play",action:function(){o.play(d)}}),d}if(r&&!s._paused)return n||setTimeout(function(){o._emit("play",s._id)},0),s._id;o._webAudio&&t._autoResume();var l=Math.max(0,s._seek>0?s._seek:o._sprite[e][0]/1e3),u=Math.max(0,(o._sprite[e][0]+o._sprite[e][1])/1e3-l),c=1e3*u/Math.abs(s._rate);s._paused=!1,s._ended=!1,s._sprite=e,s._seek=l,s._start=o._sprite[e][0]/1e3,s._stop=(o._sprite[e][0]+o._sprite[e][1])/1e3,s._loop=!(!s._loop&&!o._sprite[e][2]);var m=s._node;if(o._webAudio){var h=function(){o._refreshBuffer(s);var e=s._muted||o._muted?0:s._volume;m.gain.setValueAtTime(e,t.ctx.currentTime),s._playStart=t.ctx.currentTime,"undefined"==typeof m.bufferSource.start?s._loop?m.bufferSource.noteGrainOn(0,l,86400):m.bufferSource.noteGrainOn(0,l,u):s._loop?m.bufferSource.start(0,l,86400):m.bufferSource.start(0,l,u),c!==1/0&&(o._endTimers[s._id]=setTimeout(o._ended.bind(o,s),c)),n||setTimeout(function(){o._emit("play",s._id)},0)};"running"===t.state?h():(o.once("resume",h),o._clearTimer(s._id))}else{var _=function(){m.currentTime=l,m.muted=s._muted||o._muted||t._muted||m.muted,m.volume=s._volume*t.volume(),m.playbackRate=s._rate;try{if(m.play(),m.paused)return void o._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices where playback was not within a user interaction.");c!==1/0&&(o._endTimers[s._id]=setTimeout(o._ended.bind(o,s),c)),n||o._emit("play",s._id)}catch(e){o._emit("playerror",s._id,e)}},p=window&&window.ejecta||!m.readyState&&t._navigator.isCocoonJS;if(4===m.readyState||p)_();else{var f=function(){_(),m.removeEventListener(t._canPlayEvent,f,!1)};m.addEventListener(t._canPlayEvent,f,!1),o._clearTimer(s._id)}}return s._id},pause:function(e){var t=this;if("loaded"!==t._state)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),o=0;o<n.length;o++){t._clearTimer(n[o]);var r=t._soundById(n[o]);if(r&&!r._paused&&(r._seek=t.seek(n[o]),r._rateSeek=0,r._paused=!0,t._stopFade(n[o]),r._node))if(t._webAudio){if(!r._node.bufferSource)continue;"undefined"==typeof r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),t._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||t._emit("pause",r?r._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),r=0;r<o.length;r++){n._clearTimer(o[r]);var i=n._soundById(o[r]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,n._stopFade(o[r]),i._node&&(n._webAudio?i._node.bufferSource&&("undefined"==typeof i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),n._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause())),t||n._emit("stop",i._id))}return n},mute:function(e,n){var o=this;if("loaded"!==o._state)return o._queue.push({event:"mute",action:function(){o.mute(e,n)}}),o;if("undefined"==typeof n){if("boolean"!=typeof e)return o._muted;o._muted=e}for(var r=o._getSoundIds(n),i=0;i<r.length;i++){var a=o._soundById(r[i]);a&&(a._muted=e,o._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,t.ctx.currentTime):a._node&&(a._node.muted=!!t._muted||e),o._emit("mute",a._id))}return o;

},volume:function(){var e,n,o=this,r=arguments;if(0===r.length)return o._volume;if(1===r.length||2===r.length&&"undefined"==typeof r[1]){var i=o._getSoundIds(),a=i.indexOf(r[0]);a>=0?n=parseInt(r[0],10):e=parseFloat(r[0])}else r.length>=2&&(e=parseFloat(r[0]),n=parseInt(r[1],10));var s;if(!("undefined"!=typeof e&&e>=0&&e<=1))return s=n?o._soundById(n):o._sounds[0],s?s._volume:0;if("loaded"!==o._state)return o._queue.push({event:"volume",action:function(){o.volume.apply(o,r)}}),o;"undefined"==typeof n&&(o._volume=e),n=o._getSoundIds(n);for(var d=0;d<n.length;d++)s=o._soundById(n[d]),s&&(s._volume=e,r[2]||o._stopFade(n[d]),o._webAudio&&s._node&&!s._muted?s._node.gain.setValueAtTime(e,t.ctx.currentTime):s._node&&!s._muted&&(s._node.volume=e*t.volume()),o._emit("volume",s._id));return o},fade:function(e,n,o,r){var i=this;if("loaded"!==i._state)return i._queue.push({event:"fade",action:function(){i.fade(e,n,o,r)}}),i;i.volume(e,r);for(var a=i._getSoundIds(r),s=0;s<a.length;s++){var d=i._soundById(a[s]);if(d){if(r||i._stopFade(a[s]),i._webAudio&&!d._muted){var l=t.ctx.currentTime,u=l+o/1e3;d._volume=e,d._node.gain.setValueAtTime(e,l),d._node.gain.linearRampToValueAtTime(n,u)}i._startFadeInterval(d,e,n,o)}}return i},_startFadeInterval:function(e,t,n,o){var r=this,i=t,a=t>n?"out":"in",s=Math.abs(t-n),d=s/.01,l=d>0?o/d:o;l<4&&(d=Math.ceil(d/(4/l)),l=4),e._interval=setInterval(function(){d>0&&(i+="in"===a?.01:-.01),i=Math.max(0,i),i=Math.min(1,i),i=Math.round(100*i)/100,r._webAudio?("undefined"==typeof id&&(r._volume=i),e._volume=i):r.volume(i,e._id,!0),(n<t&&i<=n||n>t&&i>=n)&&(clearInterval(e._interval),e._interval=null,r.volume(n,e._id),r._emit("fade",e._id))},l)},_stopFade:function(e){var n=this,o=n._soundById(e);return o&&o._interval&&(n._webAudio&&o._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(o._interval),o._interval=null,n._emit("fade",e)),n},loop:function(){var e,t,n,o=this,r=arguments;if(0===r.length)return o._loop;if(1===r.length){if("boolean"!=typeof r[0])return n=o._soundById(parseInt(r[0],10)),!!n&&n._loop;e=r[0],o._loop=e}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var i=o._getSoundIds(t),a=0;a<i.length;a++)n=o._soundById(i[a]),n&&(n._loop=e,o._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return o},rate:function(){var e,n,o=this,r=arguments;if(0===r.length)n=o._sounds[0]._id;else if(1===r.length){var i=o._getSoundIds(),a=i.indexOf(r[0]);a>=0?n=parseInt(r[0],10):e=parseFloat(r[0])}else 2===r.length&&(e=parseFloat(r[0]),n=parseInt(r[1],10));var s;if("number"!=typeof e)return s=o._soundById(n),s?s._rate:o._rate;if("loaded"!==o._state)return o._queue.push({event:"rate",action:function(){o.rate.apply(o,r)}}),o;"undefined"==typeof n&&(o._rate=e),n=o._getSoundIds(n);for(var d=0;d<n.length;d++)if(s=o._soundById(n[d])){s._rateSeek=o.seek(n[d]),s._playStart=o._webAudio?t.ctx.currentTime:s._playStart,s._rate=e,o._webAudio&&s._node&&s._node.bufferSource?s._node.bufferSource.playbackRate.value=e:s._node&&(s._node.playbackRate=e);var l=o.seek(n[d]),u=(o._sprite[s._sprite][0]+o._sprite[s._sprite][1])/1e3-l,c=1e3*u/Math.abs(s._rate);!o._endTimers[n[d]]&&s._paused||(o._clearTimer(n[d]),o._endTimers[n[d]]=setTimeout(o._ended.bind(o,s),c)),o._emit("rate",s._id)}return o},seek:function(){var e,n,o=this,r=arguments;if(0===r.length)n=o._sounds[0]._id;else if(1===r.length){var i=o._getSoundIds(),a=i.indexOf(r[0]);a>=0?n=parseInt(r[0],10):o._sounds.length&&(n=o._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),n=parseInt(r[1],10));if("undefined"==typeof n)return o;if("loaded"!==o._state)return o._queue.push({event:"seek",action:function(){o.seek.apply(o,r)}}),o;var s=o._soundById(n);if(s){if(!("number"==typeof e&&e>=0)){if(o._webAudio){var d=o.playing(n)?t.ctx.currentTime-s._playStart:0,l=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(l+d*Math.abs(s._rate))}return s._node.currentTime}var u=o.playing(n);u&&o.pause(n,!0),s._seek=e,s._ended=!1,o._clearTimer(n),u&&o.play(n,!0),!o._webAudio&&s._node&&(s._node.currentTime=e),o._emit("seek",n)}return o},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var o=0;o<t._sounds.length;o++)if(!t._sounds[o]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,o=t._soundById(e);return o&&(n=t._sprite[o._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,n=e._sounds,o=0;o<n.length;o++){if(n[o]._paused||e.stop(n[o]._id),!e._webAudio){var i=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);i||(n[o]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),n[o]._node.removeEventListener("error",n[o]._errorFn,!1),n[o]._node.removeEventListener(t._canPlayEvent,n[o]._loadFn,!1)}delete n[o]._node,e._clearTimer(n[o]._id);var a=t._howls.indexOf(e);a>=0&&t._howls.splice(a,1)}var s=!0;for(o=0;o<t._howls.length;o++)if(t._howls[o]._src===e._src){s=!1;break}return r&&s&&delete r[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,o){var r=this,i=r["_on"+e];return"function"==typeof t&&i.push(o?{id:n,fn:t,once:o}:{id:n,fn:t}),r},off:function(e,t,n){var o=this,r=o["_on"+e],i=0;if("number"==typeof t&&(n=t,t=null),t||n)for(i=0;i<r.length;i++){var a=n===r[i].id;if(t===r[i].fn&&a||!t&&a){r.splice(i,1);break}}else if(e)o["_on"+e]=[];else{var s=Object.keys(o);for(i=0;i<s.length;i++)0===s[i].indexOf("_on")&&Array.isArray(o[s[i]])&&(o[s[i]]=[])}return o},once:function(e,t,n){var o=this;return o.on(e,t,n,1),o},_emit:function(e,t,n){for(var o=this,r=o["_on"+e],i=r.length-1;i>=0;i--)r[i].id&&r[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(o,r[i].fn),0),r[i].once&&o.off(e,r[i].fn,r[i].id));return o},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,function(){e._queue.shift(),e._loadQueue()}),t.action()}return e},_ended:function(e){var n=this,o=e._sprite;if(!n._webAudio&&n._node&&!n._node.ended)return setTimeout(n._ended.bind(n,e),100),n;var r=!(!e._loop&&!n._sprite[o][2]);if(n._emit("end",e._id),!n._webAudio&&r&&n.stop(e._id,!0).play(e._id),n._webAudio&&r){n._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);n._endTimers[e._id]=setTimeout(n._ended.bind(n,e),i)}return n._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,n._clearTimer(e._id),n._cleanBuffer(e._node),t._autoSuspend()),n._webAudio||r||n.stop(e._id),n},_clearTimer:function(e){var t=this;return t._endTimers[e]&&(clearTimeout(t._endTimers[e]),delete t._endTimers[e]),t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new o(e)},_drain:function(){var e=this,t=e._pool,n=0,o=0;if(!(e._sounds.length<t)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&n++;for(o=e._sounds.length-1;o>=0;o--){if(n<=t)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),n--)}}},_getSoundIds:function(e){var t=this;if("undefined"==typeof e){for(var n=[],o=0;o<t._sounds.length;o++)n.push(t._sounds[o]._id);return n}return[e]},_refreshBuffer:function(e){var n=this;return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=r[n._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.value=e._rate,n},_cleanBuffer:function(e){var t=this;if(t._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=t._scratchBuffer}catch(n){}}return e.bufferSource=null,t}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,n._sounds.push(e),e.create(),e},create:function(){var e=this,n=e._parent,o=t._muted||e._muted||e._parent._muted?0:e._volume;return n._webAudio?(e._node="undefined"==typeof t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(o,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._node.src=n._src,e._node.preload="auto",e._node.volume=o*t.volume(),e._node.load()),e},reset:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,n=e._parent;n._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(n._sprite).length&&(n._sprite={__default:[0,1e3*n._duration]}),"loaded"!==n._state&&(n._state="loaded",n._emit("load"),n._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)}};var r={},i=function(e){var t=e._src;if(r[t])return e._duration=r[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),o=new Uint8Array(n.length),i=0;i<n.length;++i)o[i]=n.charCodeAt(i);s(o.buffer,e)}else{var l=new XMLHttpRequest;l.open("GET",t,!0),l.withCredentials=e._xhrWithCredentials,l.responseType="arraybuffer",l.onload=function(){var t=(l.status+"")[0];return"0"!==t&&"2"!==t&&"3"!==t?void e._emit("loaderror",null,"Failed loading audio file with status: "+l.status+"."):void s(l.response,e)},l.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[t],e.load())},a(l)}},a=function(e){try{e.send()}catch(t){e.onerror()}},s=function(e,n){t.ctx.decodeAudioData(e,function(e){e&&n._sounds.length>0&&(r[n._src]=e,d(n,e))},function(){n._emit("loaderror",null,"Decoding audio data failed.")})},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},l=function(){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}var n=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),o=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=o?parseInt(o[1],10):null;if(n&&r&&r<9){var i=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());(t._navigator&&t._navigator.standalone&&!i||t._navigator&&!t._navigator.standalone&&!i)&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain="undefined"==typeof t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.value=t._muted?0:1,t.masterGain.connect(t.ctx.destination)),t._setup()};"function"==typeof define&&define.amd&&define([],function(){return{Howler:t,Howl:n}}),"undefined"!=typeof exports&&(exports.Howler=t,exports.Howl=n),"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=o):"undefined"!=typeof global&&(global.HowlerGlobal=e,global.Howler=t,global.Howl=n,global.Sound=o)}();var dom=document;dom.Id=dom.getElementById,dom.El=dom.createElement;var eui=0,function_queue=[];Seq.prototype={then:function(e){this.function_queue.push(e)},next:function(){var e=this;return fu=e.function_queue.shift(),!!fu&&(fu(function(){e.next()}),!0)}};var pogencnt=0;dialog||console.log("Before this script, you have to load the script defining the dialog table.");var POPREFIX_CMD="cmd_",POPREFIX_ROOM="room_",POPREFIX_ITEM="item_",POPREFIX_PEOPLE="people_",POSUFFIX_DESC="_text",POSUFFIX_EXEC_DESC="_exec",PO_NONE="none",PO_NONE_DESC=PO_NONE+POSUFFIX_DESC,PO_DEFAULT_ROOM=POPREFIX_ROOM+PO_NONE,PO_DEFAULT_ITEM=POPREFIX_ITEM+PO_NONE,PO_DEFAULT_PEOPLE=POPREFIX_PEOPLE+PO_NONE,PO_DEFAULT_ROOM_DESC=POPREFIX_ROOM+PO_NONE_DESC,PO_DEFAULT_ITEM_DESC=POPREFIX_ITEM+PO_NONE_DESC,PO_DEFAULT_PEOPLE_DESC=POPREFIX_PEOPLE+PO_NONE_DESC;String.prototype.printf=function(e){var t=-1;return this.replace(/\%[sd]/g,function(n,o){return t++,e[t]})};var type_decorations={people:'<span class="color-people">%s</span>',item:'<span class="color-item">%s</span>',room:'<span class="color-room">%s</span>',cmd:'<span class="color-cmd">%s</span>'},poe="function"==typeof pogen,var_regexp=/\{\{\w+(\.\w+|,\[([^,]*(,)?)\])?\}\}/g,var_vars_regexp=/\[([^,]*(,)?)\]/g,var_vars_regexpbis=/\.(\w+)/;Cookie.prototype={parse:function(e){for(var t=null,n=e.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "==r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(this.name)){t={};var i=r.split("=");i.shift();for(var a=0;a<i.length;a++){var s=i[a].split(":");2==s.length&&"undefined"!==s[1]&&(t[s[0]]=s[1])}break}}return t},check:function(){for(var e=dom.cookie.split(";"),t=0;t<e.length;t++){for(var n=e[t];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(this.name))return!0}return!1},stringify:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=n+":"+e[n]+"=");return t},read:function(){return this.parse(dom.cookie)},write:function(e){var t=new Date;t.setTime(t.getTime()+60*this.minutes*1e3),console.log("write cookie",e),dom.cookie=this.name+"="+this.stringify(e)+"; expires="+t.toGMTString()+"; path=/"},destroy:function(){this.minutes=-1,this.write("")}},GameState.prototype={getCurrentRoom:function(){return window[this.params[""]]},saveCookie:function(){this.cookie&&this.cookie.write(this.params)},setCurrentRoom:function(e){e.varname&&(this.params[""]=e.varname,this.saveCookie())},add:function(e,t){this.actions[e]=t},set:function(e,t){this.params[e]=t},get:function(e,t){return this.params[e]},applied:function(e){return this.actions[e]},apply:function(e,t){console.log("apply "+e),this.params[e]=1,e in this.actions&&this.actions[e]("undefined"!=typeof t&&t)},startCookie:function(e){return this.cookie=new Cookie(e),this.cookie.check()},stopCookie:function(e){this.cookie=null},setCookieDuration:function(e){this.cookie.minutes=e},loadCookie:function(){var e=this.cookie.read();if(e){for(var t in e)e.hasOwnProperty(t)&&(t in this.actions?this.apply(t,e[t]):this.set(t,e[t]));return this.saveCookie(),!0}return!1}},EventTarget.prototype={addListener:function(e,t){return hdef(this._listeners,e,t),this},fire:function(e){if("string"==typeof e&&(e={type:e}),e.target||(e.target=this),!e.type)throw new Error("Event object missing 'type' property.");if(this._listeners[e.type]instanceof Array)for(var t=this._listeners[e.type],n=0,o=t.length;n<o;n++)t[n].call(this,e);return this},removeListener:function(e,t){if(this._listeners[e]instanceof Array)for(var n=this._listeners[e],o=0,r=n.length;o<r;o++)if(n[o]===t){n.splice(o,1);break}return this}};var audiotype={mp3:"mpeg",ogg:"ogg",wav:"wav"};SoundBank.prototype={set:function(e,t,n,o){var r=this;o=d(o,{}),required=d(o.required,!0),r.ldr++,r.dict[e]=new Howl({src:n.map(function(e){return t+e}),onload:function(){r.ldr--,r.callback&&r.callback()}})},isloaded:function(){return 0==this.ldr},play:function(e){this.dict.hasOwnProperty(e)&&(this.dict[e].currenttime=0,this.dict[e].volume=1,this.dict[e].play())},get:function(e){return this.dict.hasOwnProperty(e)?this.dict[e]:null}},Music.prototype={set:function(e,t,n){this.soundbank.set(e,t,n,{required:!1})},play:function(e,t){t=d(t,{}),n=this.soundbank.get(e),this.current!==e?(console.log("play "+e),c=this.soundbank.get(this.current),c&&(c.pause(),c.currentTime=0),n&&(this.current=e,setAudioLoop(n,d(t.loop,!1)),setAudioFade(n,d(t.fadein,[1,1,0])),n.currenttime=d(t.currenttime,0),this.currentmusic=n.play())):n._loop||(n.stop(this.currentmusic),this.currentmusic=n.play())},fadeTo:function(e,t){c=this.soundbank.get(this.current),c&&setAudioFade(c,[c.volume,e,t])}},ReturnSequence.prototype={next:function(){return this.idx++,this.seq.shift()},length:function(){return this.seq.length},getIdx:function(){return this.idx}};var SAFE_BROKEN_TEXT=!0;VTerm.prototype={setContext:function(e){this.context=e},getContext:function(){return this.context},flash:function(e,t){setTimeout(function(){document.body.className+=" flash",setTimeout(function(){document.body.className=document.body.className.replace(/[ ]*flash/,"")},t)},e)},wait_free:function(e){this.waiting_fus.push(e)},run_waiting:function(){var e=this.waiting_fus.shift();e&&e(this)},loop_waiting:function(){var e=0,t=this;t.waiting_interval||(t.waiting_interval=setInterval(function(){t.busy?e=0:e>0&&t.waiting_fus.length>0?t.run_waiting():(e++,e>10&&clearInterval(t.waiting_interval))},500))},push_img:function(e,t){if(t=t||{},e){var n=d(t.index,-1);this.imgs[n]||(this.imgs[n]=[]),this.imgs[d(t.index,-1)].push(e)}return this},unset_img:function(){var e=this;e.imgs.length>0&&e.imgs.pop()},show_img:function(e){e=e||{};var t,n=this,o=d(e.index,-1),r=n.imgs[o];if(r&&r.length>0)for(var i=function(){n.scrl(1e3)},a=addEl(n.monitor,"div","img-container");t=r.shift();)t.render(a,i)},epic_img_enter:function(e,t,n,o){var r=this;r.scrl_lock=!0;var i=addEl(r.monitor,"div","img-container "+t);pic=new Pic(e),pic.render(i,function(){i.className+=" loaded",setTimeout(function(){r.scrl_lock=!1,r.scrl(),def(o)&&o(vt)},n)})},clear:function(){this.monitor.innerHTML=""},muteSound:function(){this.mute=!0},unmuteSound:function(){this.mute=!1},muteCommandResult:function(){this.cmdoutput=!1},unmuteCommandResult:function(){this.cmdoutput=!0},playSound:function(e){this.mute||this.soundbank.play(e)},get_line:function(){return this.input.value.replace(/\s+/," ")},set_line:function(e){this.input.value=e},get_cursor_pos:function(){return this.input.selectionStart},set_cursor_pos:function(e){this.input.selectionStart=e},scrl:function(e,t){var n=this,o=n.monitor;t=d(t,2);var r=o.parentNode.offsetTop+o.offsetTop+o.offsetHeight+n.inputdiv.offsetHeight-window.pageYOffset-window.innerHeight;if(r>0){if(!n.scrl_lock&&!def(e))return window.scrollBy(0,r),!0;e=d(e,100),t--,t>0&&setTimeout(function(){n.scrl(0,t)},e)}},disable_input:function(){var e=this;return!e.disabled.input&&(e.disabled.input=!0,e.btn_clear.setAttribute("disabled",""),e.btn_tab.setAttribute("disabled",""),e.inputdiv.removeChild(e.cmdline),!0)},enable_input:function(){var e=this;return!!e.disabled.input&&(e.disabled.input=!1,e.inputdiv.prepend(e.cmdline),e.btn_clear.removeAttribute("disabled"),e.btn_tab.removeAttribute("disabled"),e.enterKey=e.enter,e.input.focus(),!0)},show_previous_prompt:function(e){addEl(this.monitor,"p","input").innerText=e},_show_chars:function(e,t,n,o,r,i,a,s,d,u){l=n.shift();var c=this;if(c.busy=!0,def(l)){var m;if("<"==l){for(var h="<";def(l)&&">"!=l;)l=n.shift(),h+=l;var _=h.replace(/<([^ ]*).*>/,"$1");if("img"==_)t.innerHTML+=h,c.playSound("tag"),m=c.charfactor[l];else if("voice"==_)s=h.replace(/<([^ ]*)[ ]*([^ ]*)\/>/,"$2");else{var p="";for(l=n.shift();def(l)&&">"!=l;)p+=l,l=n.shift();t.innerHTML+=h+p}c.scrl()}else c.charfactor.hasOwnProperty(l)?(t.innerHTML+=c.charhtml[l]?c.charhtml[l]:l,c.playSound(l),m=c.charfactor[l],c.scrl()):(t.innerHTML+=l,c.charfactor["char"]>0&&d%3==1&&c.playSound(s),m=c.charfactor["char"]);o&&c.msg_idx!=e?((SAFE_BROKEN_TEXT||r)&&(t.innerHTML=a,c.scrl()),c.playSound("brokentext"),i&&i(),u.cb&&u.cb(),c.busy=!1):setTimeout(function(){c._show_chars(e,t,n,o,r,i,a,s,++d,u)},m*c.charduration)}else c.playSound("endoftext"),i&&i(),u.cb&&u.cb(),c.busy=!1},rmCurrentImg:function(e){var t=this;setTimeout(function(){var e,n=t.current_msg.getElementsByClassName("img-container");for(e=0;e<n.length;e++)msg.removeChild(n[e])},e)},show_loading_element_in_msg:function(e,t){var n=this;t=t||{};var o,r=d(t.container,n.monitor);o=t.el?t.el:addEl(r,"div","inmsg");var i=d(t.period,100),a=t.duration,s=t.finalvalue,l=t.callback,u=0,c=n.msg_idx,m=setInterval(function(){n.msg_idx!=c?(clearInterval(m),s&&(o.innerHTML=s,n.ghostel.innerHTML+=" "+s+" "),l&&l()):(o.innerHTML=e[u%e.length],u++)},i);return a&&setTimeout(function(){c==n.msg_idx&&n.msg_idx++},a),this},show_msg:function(e,t){if(def(e)){t=t||{};var n,o=this;o.busy=!0,o.loop_waiting(),"string"!=typeof e&&(n=e[1],e=e[0]);var r=d(t.el,o.monitor),i=d(t.dependant,!0),a=d(t.safe,!1),s=d(t.direct,!1);o.ghostel=addEl(o.ghost_monitor,"p"),o.current_msg=addEl(r,"p","msg"),1==e.nodeType?(o.current_msg.appendChild(e),o.ghostel.innerHTML=e.outerHTML.replace(/<div class='inmsg'.*><\/div>/,""),n&&n(),t.cb&&t.cb(),o.busy=!1):(txt=e.toString(),txt=txt.replace(/(#[^#]+#)/g,'<i class="hashtag"> $1 </i>'),txttab=txt.split(""),o.msg_idx++,txt=txt.replace(/\t/g,"&nbsp;&nbsp;").replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),o.ghostel.innerHTML=txt.replace(/<div class='inmsg'.*><\/div>/,"").replace(/(<br>)/g,"<&nbsp;><br>").replace(/[«»]/g,'"').replace(/(\.\.\.)/g,"<br>"),s?(o.current_msg.innerHTML=txt,n&&n(),t.cb&&t.cb(),o.busy=!1,o.scrl()):o._show_chars(o.msg_idx,o.current_msg,txttab,i,a,n,txt,"char",1,t))}return this},make_suggestions:function(e,t){function n(e,t){var n=new RegExp("^"+r.complete_opts.fuzzy(t),r.complete_opts["case"]);return r.complete_opts.fuzzy(e).match(n)}var o=!0,r=this;e=d(e,-1),t=d(t,!0),r.suggestions.innerHTML="";var i=r.get_line(),a=r.input.selectionStart,s=[];if(args=i.split(" "),r.suggestion_selected=null,args.length>0){var l,u=0;for(l=0;l<args.length&&(u+=args[l].length+1,!(u>a));l++);var c=args[l],m=[];if(c&&l>0)m=_completeArgs(args,l,c,r.context,n);else if(args[0].length>0)if(_hasRightForCommand(args[0],user.groups))m=_completeArgs(args,l,c,r.context,n);else{var h=_getCommands(r.context);l=0;for(var _=0;_<h.length;_++){var p=new RegExp("^"+r.complete_opts.fuzzy(c),r.complete_opts["case"]);h[_].match(p)&&m.push(h[_])}}else c="",m=_getCommands(r.context).map(addspace);if(0===m.length)r.set_line(i+"?"),setTimeout(function(){r.set_line(i+"??")},100),setTimeout(function(){r.set_line(i)},200);else if(1==m.length)if(t){var f=c.split("/");f[f.length-1]=m[0],args.splice(l,1,f.join("/")),r.set_line(args.join(" ").replace("././","./"))}else m[0]==c&&r.set_line(i+" "),r.show_suggestions(m);else{var g=commonprefix(m);if(m.indexOf(g)>-1?r.set_line(i+" "):e>-1&&(e<m.length?(s[e]="select",r.suggestion_selected=m[e]):o=!1),g.length>0&&t){var f=c.split("/");f[f.length-1]=g,args.splice(l,1,f.join("/")),r.set_line(args.join(" "))}r.show_suggestions(m,s)}}return o},show_suggestions:function(e,t){t=t||[],this.suggestions.innerHTML='<div class="visually-hidden">'+_("Suggestions")+"</div>";for(var n=0;n<e.length;n++)this.show_suggestion(e[n],t[n])},show_suggestion:function(e,t){var n=this;n.histindex=0,addBtn(n.suggestions,t,e.replace(/(#[^#]+#)/g,'<i class="hashtag"> $1 </i>'),e,function(t){n.input.value+=e,n.argsValid(n.input.value.replace(/\s+$/,"").split(" "))?n.enter():n.make_suggestions(-1,!1)}),n.scrl()},hide_suggestions:function(){this.suggestions.innerHTML=""},argsValid:function(e){return _validArgs(e.shift(),e,this.context)},echo:function(e){var t=this;if(def(e))if(e.isReturnSequence){if(!e.length())return;for(var n=[],o=0;o<e.length();o++)n.push(function(){t.show_img({index:e.getIdx()}),t.show_msg(e.next(),{cb:n.shift()})});n.shift()()}else t.show_img(),t.cmdoutput&&t.show_msg(e)},enter:function(){var e=this;e.playSound("enter");var t=e.get_line().replace(/\s+$/,"");if(t.length>0){var n=e.input,o=e.monitor;e.monitor=addEl(o,"div","screen"),e.histindex=0,e.show_previous_prompt(n.value),e.history.push(n.value);var r=t.split(" ");e.echo(_parse_exec(e,r)),e.set_line(""),e.hide_suggestions(),e.monitor=o}},enterKey:this.enter,behave:function(){this.global_behavior(),this.input_behavior()},global_behavior:function(){window.onbeforeunload=function(e){return"Quit the game ?"}},_cmdline_key:function(){},input_behavior:function(){var e=this,t=e.input;dom.body.onkeydown=function(n){if(n=n||window.event,def(e.battle_scene))e.battle_scene.onkeydown(n);else if(def(e.choose_input))n.preventDefault();else{var o=n.key;if("ArrowRight"===o||"ArrowLeft"===o||"ArrowUp"===o||"ArrowDown"===o)n.shiftKey&&n.preventDefault();else{var r=dom.activeElement;r&&r==t||(t.focus(),e.scrl()),t.onkeydown(n)}}},dom.body.onkeyup=function(n){if(n=n||window.event,def(e.battle_scene))e.battle_scene.onkeyup(n);else if(def(e.choose_input))e._choose_key(n.key,n);else{var o=n.key;if("ArrowRight"===o||"ArrowLeft"===o||"ArrowUp"===o||"ArrowDown"===o)n.shiftKey&&n.preventDefault();else{var r=dom.activeElement;r&&r==t||(t.focus(),e.scrl()),t.onkeyup(n)}}};var n=[null,0];t.onkeydown=function(e){var n=e.key;return"Tab"===n||"Enter"==n?overide(e):e.ctrlKey?"c"!==n&&"v"!==n&&"x"!==n&&"y"!==n&&"z"!==n||overide(e):"PageUp"!==n&&"PageDown"!==n||(window.focus(),t.blur()),"ArrowUp"!==n&&"ArrowDown"!==n||overide(e),!e.defaultPrevented},t.onkeyup=function(o){var r=o.key;if(vt.statkey[r]=(vt.statkey[r]||0)+1,n[0]==r?n[1]++:n[1]=0,n[0]=r,e.hide_suggestions(),"Enter"===r)overide(o),e.suggestion_selected?(e.input.value+=e.suggestion_selected,e.suggestion_selected=0,e.make_suggestions(),n[0]="Tab"):e.enter(),e.scrl();else if("Tab"!==r||o.ctrlKey||o.altKey){if(o.ctrlKey){if("c"===r)overide(o),e.show_previous_prompt(e.get_line()+"^C"),e.msg_idx++,e.set_line("");else if("u"===r)overide(o),e.set_line("");else if("v"===r||"x"===r){overide(o);var i=e.get_line();i=i.replace(/\/$/,"");var a=i.split(" "),s=a.pop().split("/");s.pop(),s.length>1&&s.push(""),a.push(s.join("/")),e.set_line(a.join(" "))}}else if("PageUp"===r||"PageDown"===r)window.focus(),t.blur();else if("ArrowDown"===r)e.histindex>0&&(e.histindex--,e.set_line(e.history[e.history.length-1-e.histindex]));else if("ArrowUp"===r&&e.histindex<e.history.length){var d=e.history[e.history.length-1-e.histindex];if(0===e.histindex){var l=e.get_line();l.length>0&&l!==d&&e.history.push(l)}e.set_line(d),e.histindex++}}else overide(o),e.make_suggestions(n[1]-1)||(n[1]=0),e.scrl();return!o.defaultPrevented}},badge:function(e,t){var n=this,o=addEl(n.notifications,"div","badge"),r=Date.now(),i=n.last_notify-r,a=0;i>0&&(a=i);var s=a+n.timeout.badge/2,d=a+n.timeout.badge;setTimeout(function(){n.notifications.removeChild(o)},d),setTimeout(function(){o.className+=" disappear"},s),setTimeout(function(){n.badge_pic.render(o),addEl(o,"span","badge-title").innerHTML=e,addEl(o,"p","badge-desc").innerText=t},a),n.last_notify=r+d},notification:function(e){var t=this,n=addEl(t.notifications,"div","notification"),o=Date.now(),r=t.last_notify-o,i=0;r>0&&(i=r);var a=i+t.timeout.notification/2,s=i+t.timeout.notification;setTimeout(function(){t.notifications.removeChild(n)},s),setTimeout(function(){n.className+=" disappear"},a),setTimeout(function(){addEl(n,"p").innerHTML=e},i),t.last_notify=o+s},ask_choose:function(e,t,n,o){var r=this,i=[],a=0;for(o=d(o,{}),disabled_choices=d(o.disabled_choices,[]),direct=d(o.direct,!1);disabled_choices.indexOf(a)>-1;)a++;var s=addEl(r.monitor,"div","choicebox");r.show_msg(e,{direct:direct,el:s,dependant:!1}),r.set_line(""),r.choose_input=addEl(s,"fieldset","choices");var l=r.disable_input(),u=function(e){var t=e.target.getAttribute("idx");return addAttrs(i[a],{checked:""}),addAttrs(i[t],{checked:"checked"}),a=t,r.enterKey()},c=function(e){r._choose_key(e.key,e)};r.enterKey=function(e){r.playSound("choiceselect"),r.choose_input.value=t[a],r.show_msg(t[a],{el:s,dependant:!1}),s.removeChild(r.choose_input),r.choose_input=void 0,l&&r.enable_input(),r.show_msg(n(r,a))},r._choose_key=function(e,n){if("ArrowDown"==e||"ArrowUp"==e||"Tab"==e){if(r.playSound("choicemove"),i[a].removeAttribute("checked"),"ArrowDown"==e||!n.shiftKey&&"Tab"==e)for(a=++a%i.length;disabled_choices.indexOf(a)>-1;)a=++a%i.length;else if("ArrowUp"==e||n.shiftKey&&"Tab"==e)for(a=--a>=0?a:i.length-1;disabled_choices.indexOf(a)>-1;)a=--a>=0?a:i.length-1;addAttrs(i[a],{checked:"checked"}),i[a].focus(),r.ghostel.innerHTML=t[a]}else"Enter"==e&&r.enterKey();n.preventDefault()};for(var m=0;m<t.length;m++)disabled_choices.indexOf(m)==-1?(cho=addEl(r.choose_input,"div","choice"),t[m]=t[m],i.push(addEl(cho,"input",{type:"radio",name:"choose",idx:m,id:"radio"+m})),addAttrs(i[m],{role:"log","aria-live":"polite","aria-relevant":"all"}),i[m].onclick=u,i[m].onkeydown=c,addEl(cho,"span","selectpointer"),addEl(cho,"label",{"for":"radio"+m}).innerHTML=t[m].replace(/(#[^#]+#)/g,'<i class="hashtag"> $1 </i>')):i.push(null);r.choose_input.onkeydown=c,addAttrs(r.choose_input,{value:t[a]}),addAttrs(i[a],{checked:"checked"}),r.scrl()},battlescene:function(e,t){var n=this;n.set_line("");var o=n.monitor,r=addEl(o,"div","battlescene-container");n.battle_scene=addEl(r,"div","battlescene"),n.disable_input();var i=function(){n.battle_scene.setAttribute("disabled",!0),o.removeChild(r),n.battle_scene=void 0,t&&t()};return n.enterKey=function(){console.log("Enter Pressed but Battle Mode")},e(vt,n.battle_scene,i)},ask:function(e,t,n){var o=this;o.set_line("");var r=n.wait||0,i=n.timeout||null,a=addEl(o.monitor,"div",n.cls||"choicebox");o.show_msg([e,function(){setTimeout(function(){var e=addEl(a,"div","input-wrapper");n.multiline?o.answer_input=addEl(e,"textarea",{cols:78}):o.answer_input=addEl(e,"input",{size:78});var t=addEl(a,"div","keys");addBtn(t,"key","↵","Enter",function(e){o.enterKey()}),n.value&&(o.answer_input.value=n.value),n.placeholder&&(o.answer_input.placeholder=n.placeholder),o.answer_input.focus(),o.answer_input.onkeyup=function(e){if("Enter"===e.key)if(e.ctrlKey||!n.multiline)o.enterKey(),e.preventDefault(),o.scrl();else{var t=o.answer_input.selectionStart,r=o.answer_input.value.substr(0,t),i=o.answer_input.value.substr(t);o.answer_input.value=r+"\n"+i,o.answer_input.selectionStart=t+1,o.answer_input.selectionEnd=t+1}}},r),i&&setTimeout(function(){o.playSound("choiceselect");var e=o.answer_input.value;e=t?t(e):e,l(),o.echo(e)},r+i)}],{el:a,dependant:!1});var s=!o.disabled.input,d=null;n.disappear&&(d=function(){a.outerHTML=""}),o.disable_input();var l=function(){o.answer_input.setAttribute("disabled",!0),o.answer_input=void 0,n.disappear&&n.disappear(d),s&&o.enable_input()};o.enterKey=function(){o.playSound("choiceselect");var e=o.answer_input.value;e=t?t(e):e,l(),o.echo(e)}},auto_shuffle_input_msg:function(e,t,n,o,r,i,a){var s=this,d=s.msg_idx;s.input_operation_interval&&clearInterval(s.input_operation_interval);var l=0,u=t,c=n>t?1:-1,m=n*c,h=(n-t)/o;s.input_operation_interval=setInterval(function(){s.msg_idx!=d?(clearInterval(s.input_operation_interval),s.set_line("")):(u*c<m&&l%a==0&&(u+=h),s.shuffle_input_msg(e,u),l++)},r),i&&setTimeout(function(){d==s.msg_idx&&s.msg_idx++},i)},auto_shuffle_input:function(e,t,n,o,r){var i=this,a=i.msg_idx;i.input_operation_interval&&clearInterval(i.input_operation_interval);var s=0,d=e;i.input_operation_interval=setInterval(function(){i.msg_idx!=a?(clearInterval(i.input_operation_interval),i.set_line("")):r?(s%r==0&&d++,i.shuffle_input(d,null),s++):i.shuffle_input(e,t)},n),o&&setTimeout(function(){a==i.msg_idx&&i.msg_idx++},o)},shuffle_input:function(e,t){var n=e+(t?Math.round(Math.random()*(t-e)):0);this.set_line(randomStr(n))},shuffle_input_msg:function(e,t){this.set_line(shuffleStr(e,t))}};var user={groups:[],name:"",address:""},TESTING=!1,ARGT={dir:[0],file:[1],opt:[2],instr:[3],"var":[4],strictfile:[5],cmdname:[6],filename:[7],filenew:[8],dirnew:[9],pattern:[10],msgid:[12]},global_commands_fu={},global_fireables={done:[]};_setupCommand("less",null,[ARGT.strictfile],function(e,t){var n=t.getContext(),o=[];if(e.length<1)return n.fire_event(t,"less_no_arg",e,0),_("cmd_less_no_arg");for(var r=0;r<e.length;r++){var i=n.traversee(e[r]),a=i.room;if(a){var s=i.item;s?s.readable||n.sudo?(t.push_img(s.picture,{

index:o.length}),a.fire_event(t,"less",e,r),s.fire_event(t,"less",e,r),o.push(cmd_done(t,[[a,0],[s,r+0]],s.cmd_text.less,"less",e))):s.fire_event(t,"unreadable",e,r):(a.fire_event(t,"destination_unreachable",e,r),o.push(_("item_not_exists",e)))}else a.fire_event(t,"destination_unreachable",e,r),o.push(_("room_unreachable"))}return new ReturnSequence(o)}),_lnCommand("cat","less"),_lnCommand("more","less"),_setupCommand("ls","dir",[ARGT.dir],function(e,t){function n(e,t){var n,o="",r={};if(t=t||{item:"item",people:"people",subroom:"inside-room"},e.children.length>0||!e.isRoot){for(tmpret="",n=0;n<e.children.length;n++)tmpret+=span("color-room",e.children[n].toString()+"/")+"\n\t",e.children[n].picture&&e.children[n].picture.shown_as_item&&(e.children[n].picture.setOneShotRenderClass(t.subroom),r["room-"+n]=e.children[n].picture);o+=_("directions",["\t"+(e.isRoot?"":span("color-room","..")+" (revenir sur tes pas)\n\t")+tmpret])+"\t\n"}var i=e.items.filter(function(e){return!e.people}),a=e.items.filter(function(e){return e.people});for(n=0;n<a.length;n++)a[n].picture&&a[n].picture.shown_in_ls&&(a[n].picture.setOneShotRenderClass(t.people),r["peoples-"+n]=a[n].picture);for(a.length>0&&(o+=_("peoples",["\t"+a.map(function(e){return span("color-people",e.toString())}).join("\n\t")])+"\t\n"),n=0;n<i.length;n++)i[n].picture&&i[n].picture.shown_in_ls&&(i[n].picture.setOneShotRenderClass(t.item),r["item-"+n]=i[n].picture);return i.length>0&&(o+=_("items",["\t"+i.map(function(e){return span("color-item"+(e.executable?" color-executable":""),e.toString())}).join("\n\t")])+"\t\n"),{txt:o,pics:r}}var o,r=t.getContext();if(e.length>0){var i=r.traversee(e[0]).room;return i?i.readable||r.sudo?(0===i.children.length&&0===i.items.length?prtls={pics:{},txt:_("room_empty")}:prtls=n(i),o=i.picture.copy(),o.addChildren(prtls.pics),o.setOneShotRenderClass("room"),t.push_img(o),cmd_done(t,[[i,0]],prtls.txt,"ls",e)):_("permission_denied")+" "+_("room_unreadable"):_("room_unreachable")}return prtls=n(r),o=r.picture.copy(),o.addChildren(prtls.pics),o.setOneShotRenderClass("room"),t.push_img(o),cmd_done(t,[[r,0]],prtls.txt,"ls",e)}),_setupCommand("cd","dir",[ARGT.dir],function(e,t){var n=t.getContext();if(e.length>1)return _("cmd_cd_flood");if("-"!==e[0]){if(0===e.length)return _("cmd_cd_no_args")+(_hasRightForCommand("pwd")?"\n"+_("cmd_cd_no_args_pwd"):"");if("~"===e[0])return $home.previous=n,enterRoom($home,t),_("cmd_cd_home");if(".."===e[0])return n.fire_event(t,"cd",e,0),n.parents.length>=1?(n.parents[0].previous=n,_("cmd_cd_parent",enterRoom(n.parents[0],t))):_("cmd_cd_no_parent");if("."===e[0])return t.push_img(img.room_none),_("cmd_cd",enterRoom(n,t));var o=n.traversee(e[0]),r=o.room;return r&&!o.item_name?r.executable?(r.previous=n,_("cmd_cd",enterRoom(r,t))):(n.fire_event(t,"cd",e,0,{unreachable_room:r}),r.cmd_text.cd):(n.fire_event(t,"cd",e,0,{unreachable_room:r}),_("cmd_cd_failed",e))}n.previous.previous=n,enterRoom(n.previous,t)}),_setupCommand("man","help",[ARGT.cmdname],function(e,t){return _(e.length<1?"cmd_man_no_query":"man_"+e[0]in dialog?"man_"+e[0]:"cmd_man_not_found")}),_setupCommand("help",null,[ARGT.cmdname],function(e,t){ret=_("cmd_help_begin")+"\n";for(var n=_getUserCommands(),o=0;o<n.length;o++)ret+="<pre>"+n[o]+"\t</pre>: "+_("help_"+n[o])+"\n";return ret}),_setupCommand("exit",null,[],function(e,t){return setTimeout(function(){dom.body.innerHTML=_("cmd_exit_html")},2e3),_("cmd_exit")}),_setupCommand("pwd",null,[],function(e,t){var n=t.getContext();return t.push_img(n.picture),_(POPREFIX_CMD+"pwd",[n.name]).concat("\n").concat(n.intro_text)}),_setupCommand("cp",null,[ARGT.file,ARGT.filenew],function(e,t){var n=t.getContext();if(2!=e.length)return _("incorrect_syntax");var o=n.traversee(e[0]),r=n.traversee(e[1]);if(o.item){if(r.item)return _("tgt_already_exists",[r.item_name]);if(r.room)return nut=o.item.copy(r.item_name),r.room.addItem(nut),nut.fire_event(t,"cp",e,1),o.item.fire_event(t,"cp",e,0),r.room.fire_event(t,"cp",e,1),cmd_done(t,[[o.item,0],[nut,1]],_("cmd_cp_copied",e),"cp",e)}return _("cmd_cp_unknown")}),_setupCommand("mv",null,[ARGT.strictfile,ARGT.file],function(e,t){var n,o=t.getContext(),r=[],i=o.traversee(e[e.length-1]);if(!(i.item_name&&e.length>2)){for(var a,s,d=[],l=0;l<e.length-1;l++)n=o.traversee(e[l]),n.room?n.item&&i.room?(a=i.item_name&&n.item_name!==i.item_name,s=i.item,i.room.writable?n.item_idx>-1&&(n.room.writable?(s&&i.room.removeItemByIdx(i.item_idx),a&&(n.item.name=i.item_name),n.room.fire_event(t,"mv",[e[l],e[e.length-1]],0),n.room.uid!==i.room.uid?(i.room.addItem(n.item),n.room.removeItemByIdx(n.item_idx),n.item.fire_event(t,"mv_outside",[e[l],e[e.length-1]],0),"mv"in n.item.cmd_text?r.push(n.item.cmd_text.mv):r.push(_("cmd_mv_done",[e[l],e[e.length-1]]))):n.item.fire_event(t,"mv_local",[e[l],e[e.length-1]],0),n.item.fire_event(t,"mv",[e[l],e[e.length-1]],0),a&&(n.item.fire_event(t,"mv_name",e,0),"mv_name"in n.item.cmd_text?r.push(n.item.cmd_text.mv_name):s||r.push(_("cmd_mv_name_done",[e[l],e[e.length-1]]))),s&&r.push(_("cmd_mv_overwrite_done",[e[l],e[e.length-1]])),d.push([n.item,0])):"mv"in n.item.cmd_text?r.push(n.item.cmd_text.mv):r.push(_("permission_denied")+" "+_("cmd_mv_fixed"))):r.push(_("permission_denied")+" "+_("cmd_mv_dest_fixed"))):!n[2]:r.push(_("cmd_mv_no_file",[e[l]]));return cmd_done(t,d,r.join("\n"),"mv",e)}return r.push(_("cmd_mv_flood")),r.join("\n")}),_setupCommand("rm",null,[ARGT.file],function(e,t){var n=t.getContext();if(e.length<1)return _("cmd_rm_miss");for(var o,r,i="",a=0;a<e.length;a++){var s=n.traversee(e[a]);if(o=s.room,r=s.item_idx,r>-1){if(!o.writable)return s.item.cmd_text.rm||_("cmd_rm_invalid");var d=o.removeItemByIdx(r);d?(o.fire_event(t,"rm",e,a),i+="rm"in d.cmd_text?d.cmd_text.rm+"\n":_("cmd_rm_done",[e[a]]),d.fire_event(t,"rm",e,a)):i+=_("cmd_rm_failed")}return i}}),_setupCommand("grep",null,[ARGT.pattern,ARGT.strictfile],function(e,t){for(var n=t.getContext(),o=e[0],r=e.slice(1),i=[],a=0;a<r.length;a++){var s=r[a],d=n.traversee(s);if(d.item){var l=d.item.cmd_text.less,u=[],c=!1;if(d.item.readable||n.sudo){if(d.item.cmd_text.grep){var m="";if(o.length>2&&(o.split(" ").filter(function(e){m.length<e.length&&(m=e)}),u=d.item.cmd_text.grep.split(/( |\n)/).filter(function(e){return e.length>1&&e.indexOf(m)>=0&&m.length>e.length/2}),u.length>0&&(l=d.item.cmd_text.grep,c=!0)),d.item.cmd_text.grep_overflow&&!c&&m.length<6){i.push(d.item.cmd_text.grep_overflow);continue}}}else d.item.fire_event(t,"unreadable");u=l.split("\n");var h=u.filter(function(e){return e.indexOf(o)>=0});h.length>0&&i.push(h.join("\n"))}else i.push(_("item_not_exists",[d.toString()]))}return i.join("\n")}),_setupCommand("touch",null,[ARGT.filenew],function(e,t){var n=t.getContext();if(e.length<1)return _("cmd_touch_nothing");for(var o="",r=e.length-1;r>=0;r--){if(n.getItemFromName(e[r]))return _("tgt_already_exists",[e[r]]);e[r].length>0&&(n.addItem(new Item(e[r],_("item_intro",[e[r]]))),o+=e[r],n.fire_event(t,"touch",e,r))}return""===o?_("cmd_touch_none"):_("cmd_touch_created",[o])}),_setupCommand("mkdir",null,[ARGT.dirnew],function(e,t){var n=t.getContext();if(1===e.length){var o=n.traversee(e[0]);return o.room.writable?o.item?_("tgt_already_exists",[e[0]]):(o.room.addPath(new Room(o.item_name,(void 0),(void 0),{writable:!0})),n.fire_event(t,"mkdir",e,0),_("room_new_created",e)):_("permission_denied")+" "+_("room_not_writable")}return _("incorrect_syntax")}),_setupCommand("unzip",null,[ARGT.file.concat(["*.zip"])],function(e,t){var n=t.getContext();if(1===e.length){var o=n.traversee(e[0]);return o.item&&o.room.writable?(o.item.fire_event(t,"unzip",e,0),""):_("item_cmd_unknow","unzip")}return _("incorrect_syntax")}),PlatformGrid.prototype.check=function(e,t,n,o){var r=this,i=!1;if(e>=r.range[0][0]&&t>=r.range[1][0]&&e+n<=r.range[0][1]&&t+o<=r.range[1][1]){var a=Math.floor(t/r.y),s=Math.floor(e/r.x),d=Math.floor((t+o)/r.y),l=Math.floor((e+n)/r.x);if(a>=0&&s>=0&&a<r.matrix.length){i=!0;for(var u=a;u<=d;u++)for(var c=s;c<=l;c++)i=i&&0==r.matrix[u][c]}}return i},PicLayers.prototype={_setOffset:function(e,t){var n=this,o=n.offset_prop,r=!o.grid||o.grid.check(e,t,100*n.cont.offsetWidth/n.cont.parentNode.offsetWidth,0);return!!r&&(n.offset=[e,t],n.cont.setAttribute("style",o.prop[0]+":"+n.offset[0]+o.unit[0]+";"+o.prop[1]+":"+n.offset[1]+o.unit[1]+";"),n.cont.className="layers "+n.image_class+n.othercls+(n.reverseX?" reverseX":"")+(n.reverseY?" reverseY":""),n.gravity&&!n.falling&&n.gravity(),!0)},collide:function(e){var t=this,n=t.cont.parentNode.offsetWidth,o=t.cont.parentNode.offsetHeight,r=t.offset[0],i=t.offset[1],a=100*t.cont.offsetHeight/o,s=100*t.cont.offsetWidth/n,d=e.offset[0],l=e.offset[1],u=100*e.cont.offsetHeight/o,c=100*e.cont.offsetWidth/n;return r<d+c&&r+s>d&&i<l+u&&a+i>l},setPlatformGrid:function(e,t){this.offset_prop.grid=new PlatformGrid(e,t||this.offset_prop.range)},getPlatformGrid:function(e){return this.offset_prop.grid},fallTo:function(e,t,n,o){var r,i,a,s,d=this,l=(d.offset_prop,t[1]<0);if(!d.falling||0==t[1]){d.falling=!0;var u=function(){(t[0]||t[1])&&(r=d.offset[0]+t[0],i=d.offset[1]+t[1],nowall=d._setOffset(r,i),a=0!=t[0]&&Math.sign(t[0])*r<e[0],s=0!=t[1]&&Math.sign(t[1])*i<e[1],nowall||(nowall=d._setOffset(d.offset[0],i),nowall&&(t[0]=0,a=!1)),nowall||(nowall=d._setOffset(r,d.offset[1]),nowall&&(t[1]=0,s=!1)),nowall&&(s||a)?setTimeout(u,n):(d.falling=!1,o&&o(d,r,i),d.gravity&&!l&&d.gravity()))};u()}},fallToY:function(e,t,n,o){this.fallTo([this.offset[0],e],[0,t],n,o)},fallToX:function(e,t,n,o){this.fallTo([e,this.offset[1]],[t,0],n,o)},setOffsetProp:function(e){this.offset_prop=union(this.offset_prop,e)},setOffset:function(e){return this._setOffset(e[0],e[1])},setOffsetDelta:function(e,t){var n=this;return t*=n.gravity_coef,n._setOffset(n.offset[0]+e,n.offset[1]+t)},setOffsetDeltaX:function(e){var t=this;return t._setOffset(t.offset[0]+e,t.offset[1])},setOffsetDeltaY:function(e){var t=this;return e*=t.gravity_coef,t._setOffset(t.offset[0],t.offset[1]+e)},setOffsetDeltaXStepped:function(e,t,n,o){var r=this;r.fallTo([r.offset[0]+e,r.offset[1]],[t,0],n,o)},setOffsetDeltaYStepped:function(e,t,n,o){var r=this;e*=r.gravity_coef,r.fallTo([r.offset[0],r.offset[1]+e],[0,t],n,o)},getOffset:function(){return this.offset},getOffsetProp:function(){return this.offset_prop},update:function(){var e=this,t=e.cont,n=e.onload;t.innerHTML="",t.className="layers "+e.pic.image_class+" "+e.othercls+(e.reverseX?" reverseX":"")+(e.reverseY?" reverseY":"");var o=addEl(t,"div",{"class":"foreground","aria-hidden":"true"}),r=addEl(t,"div",{"class":"background","aria-hidden":"true"});e.pic.src&&(addEl(t,"img",{"class":"main "+(e.pic.cls||"")+" "+(e.pic.tmpcls||""),src:e.pic.img_dir+e.pic.src,"aria-hidden":"true"}).onload=n,delete e.pic.tmpcls);var i=0;for(var a in e.pic.children)if(e.pic.children.hasOwnProperty(a)){var s=e.pic.children[a];s.render_as_child(s.index<0?r:o,i+1)&&i++}}},Pic.prototype={set:function(e){this.src=e},setOneShotRenderClass:function(e){this.tmpcls=e},setImgClass:function(e){this.image_class=e},copy:function(e){return new Pic(this.src,{img_dir:this.img_dir,cls:this.cls,shown_in_ls:this.shown_in_ls,image_class:this.image_class,children:clone(this.children)})},addChildren:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.children[t]=e[t])},setChild:function(e,t,n){var o=!this.children.hasOwnProperty(e);return this.children[e]=isStr(t)?new Pic(t,union(n,{cls:"livelayer"})):t,o},unsetChild:function(e){delete this.children[e]},exists:function(){return this.src||this.children.length},render_as_child:function(e,t){if(this.src){addEl(e,"img",{"class":"layer layer-"+t+" "+(this.cls||"")+" "+(this.tmpcls||""),src:this.img_dir+this.src,"aria-hidden":"true"});for(var n in this.children)if(this.children.hasOwnProperty(n)){var o=this.children[n];o.render_as_child(e,t)}return delete this.tmpcls,!0}return!1},render:function(e,t){var n=this;if(n.exists()){var o=addEl(e,"div","layers");o.onload=t;var r=new PicLayers(n,o,t);return r.update(),r}return null}};var global_uid={};File.prototype=union(EventTarget.prototype,{toString:function(){return this.name},chmod:function(e){return this.readable=d(e.read,this.readable),this.executable=d(e.exec,this.readable),this.writable=d(e.write,this.readable),this},setReadable:function(e){return this.readable=d(e.read,this.readable),this},setWritable:function(e){return this.writable=d(e.write,this.readable),this},setExecutable:function(e){return this.executable=d(e.exec,this.readable),this},getName:function(){return this.name},setName:function(e){return this.name=e,this},getPic:function(){return this.picture},setPic:function(e){this.picture.set(e)},unsetCmdEvent:function(e){return delete this.cmd_event[e],this},setCmdEvent:function(e,t){return this.cmd_event[e]=t||e,this},setCmdEvents:function(e){for(var t in e)e.hasOwnProperty(t)&&this.setCmdEvent(t,e[t]);return this},setCmdText:function(e,t){return this.cmd_text[e]=t,this},unsetCmdText:function(e){return delete this.cmd_text[e],this},addState:function(e,t){return e=this.uid+e,this.addListener(e,state.Event),state.add(e,t),this},addStates:function(e){if(isObj(e))for(var t in e)e.hasOwnProperty(t)&&(name=this.uid+t,this.addListener(name,state.Event),state.add(name,e[t]));else console.error("addStates shall receive a dictionnary {} as argument, if you want to declare only on state us addState");return this},apply:function(e){return this.fire(this.uid+e),this}}),Item.prototype=union(File.prototype,{addPicMod:function(e,t,n){var o=new Pic(t,n);return this.picture.setChild(e,o),this},rmPicMod:function(e,t){return this.picture.unsetChild(e,newpic),this},copy:function(e){var t=new Item(e);return t.picture=this.picture.copy(),t.cmd_text=clone(this.cmd_text),t.valid_cmds=clone(this.valid_cmds),t.cmd_event=clone(this.cmd_event),t._listeners=clone(this._listeners),t.room=this.room,t.people=this.people,t.poprefix=this.poprefix,t},setExecFunction:function(e){this.exec_function=e},unsetExecFunction:function(){this.exec_function=void 0},exec:function(e,t,n){var o=this;return this.fire_event(n,"exec",e),this.exec_function?this.exec_function(this,e,t,n):cmd_done(n,[[o,0]],"","exec",e)},setPo:function(e,t){return this.poid=this.poprefix+e,this.povars=t,this.name=_(this.poid,t),this.cmd_text.less=_(this.poid+POSUFFIX_DESC,t),this},checkTextIdx:function(e){return dialog.hasOwnProperty(this.poid+POSUFFIX_DESC+e)},setTextIdx:function(e,t){return this.cmd_text.less=_(this.poid+POSUFFIX_DESC+e,t,{or:this.poid+POSUFFIX_DESC}),this},setPoDelta:function(e){return"string"==typeof e?this.poid+=e:this.povars=e,this.name=_(this.poid,this.povars),this.cmd_text.less=_(this.poid+POSUFFIX_DESC,this.povars),this},fire_event:function(e,t,n,o){var r=null,i={term:e,room:this.room,item:this,arg:def(o)?n[o]:null,args:n,i:o};if(t in this.cmd_event&&(console.log(this.uid+" EVENT "+t),r=this.cmd_event[t]),r){var a="function"==typeof r?r(i):r;a&&(console.log(this.uid+" FIRE "+a),this.fire(this.uid+a))}},disappear:function(){this.room.removeItemByName(this.name)},moveTo:function(e){return this.room.removeItemByName(this.name),e.addItem(this),this}}),People.prototype=Item.prototype;var regexp_str=/^['"].*['"]$/,regexp_star=/.*\*.*/,global_spec={};Room.prototype=union(File.prototype,{fire_event:function(e,t,n,o,r){r=d(r,{});var i=null,a={term:e,room:this,arg:def(o)?n[o]:null,args:n,i:o,ct:r};if(r.hasOwnProperty("unreachable_room")?r.unreachable_room.name in global_spec&&t in global_spec[r.unreachable_room.name]&&(i=global_spec[r.unreachable_room.name][t]):t in this.cmd_event&&(i=this.cmd_event[t]),i){var s="function"==typeof i?i(a):i;s&&this.fire(this.uid+s)}},setIntroText:function(e){return this.intro_text=e,this},addCommand:function(e){return this.suggestions.push(e),this},removeCommand:function(e){rmIdxOf(this.suggestions,e)},checkTextIdx:function(e){return dialog.hasOwnProperty(this.poid+POSUFFIX_DESC+e)},setTextIdx:function(e,t){return this.intro_text=_(this.poid+POSUFFIX_DESC+e,t,{or:this.poid+POSUFFIX_DESC}),this},setEnterCallback:function(e){return this.enter_callback=e,this},setLeaveCallback:function(e){return this.leave_callback=e,this},getStarterMsg:function(e){return e=e||"",this.starter_msg?e+this.starter_msg:e+_(POPREFIX_CMD+"pwd",[this.name]).concat("\n").concat(this.intro_text)},setStarterMsg:function(e){return this.starter_msg=e,this},addItem:function(e){return pushDef(e,this.items),e.room=this,this},newItem:function(e,t,n){n=d(n,{}),n.poid=d(n.poid,e);var o=new Item("","",t,n);return this.addItem(o),o},newPeople:function(e,t,n){n=d(n,{}),n.poid=d(n.poid,e);var o=new People("","",t,n);return this.addItem(o),o},newItemBatch:function(e,t,n,o){var r=[];o=d(o,{});for(var i=0;i<t.length;i++)o.poid=e,o.povars=[t[i]],r[i]=new Item("","",n,o),this.addItem(r[i]);return r},removeItemByIdx:function(e){return e==-1?null:this.items.splice(e,1)[0]},removeItemByName:function(e){return idx=this.idxItemFromName(e),this.removeItemByIdx(idx)},hasItem:function(e,t){return t=t||[],idx=this.idxItemFromName(_(POPREFIX_ITEM+e,t)),idx>-1},removeItem:function(e,t){return t=t||[],idx=this.idxItemFromName(_(POPREFIX_ITEM+e,t)),this.removeItemByIdx(idx)},hasPeople:function(e,t){return t=t||[],idx=this.idxItemFromName(_(POPREFIX_PEOPLE+e,t)),idx>-1},removePeople:function(e,t){return t=t||[],idx=this.idxItemFromName(_(POPREFIX_PEOPLE+e,t)),this.removeItemByIdx(idx)},idxItemFromName:function(e){return this.items.map(objToStr).indexOf(e)},idxChildFromName:function(e){return this.children.map(objToStr).indexOf(e)},getItemFromName:function(e){return idx=this.idxItemFromName(e),idx==-1?null:this.items[idx]},getItem:function(e){return this.getItemFromName(_("item_"+e))},getChildFromName:function(e){return idx=this.children.map(objToStr).indexOf(e),idx==-1?null:this.children[idx]},hasChild:function(e){return idx=this.children.map(objToStr).indexOf(e.name),idx==-1?null:this.children[idx]},addPath:function(e,t){return def(e)&&!this.hasChild(e)&&(this.children.push(e),d(t,!0)&&(e.parents.push(this),e.isRoot=!1)),this},doLeaveCallbackTo:function(e){if(t=this,t.uid===e.uid);else if(t.parents.length){var n=t.parents[0];"function"==typeof t.leave_callback&&t.leave_callback(),n&&n.doLeaveCallbackTo(e)}},hasParent:function(e,t){t=d(t,!1);for(var n=!1,o=this.parents,r=0;r<(t?o.length:o.length?1:0);r++)n=o[r].uid==e.uid||n||o[r].hasParent(e);return n},removeParentPath:function(e){rmIdxOf(this.parents,e)},removePath:function(e){rmIdxOf(this.children,e)&&rmIdxOf(e.parents,this)},setOutsideEvt:function(e,t){return global_spec[this.name][e]=t,this},unsetOutsideEvt:function(e){return delete global_spec[this.name][e],this},can_cd:function(e){if("~"===e)return $home;if(".."===e)return this.parents[0];if("."===e)return this;if(e&&e.indexOf("/")==-1)for(var t=this.children,n=0;n<t.length;n++)if(e===t[n].toString())return t[n];return null},traversee:function(e){var t=this.pathToRoom(e),n={};if(n.room=t[0],n.item_name=t[1],n.item_idx=-1,n.room&&(n.room_name=n.room.name,n.item_name))for(i=0;i<n.room.items.length;i++)if(n.item_name===n.room.items[i].toString()){n.item=n.room.items[i],n.item_idx=i;break}return n},pathToRoom:function(e){for(var t=e.split("/"),n=this,o=null,r=!0,i="",a=0;a<t.length-1&&(n&&n.executable);a++)n=n.can_cd(t[a]),n&&(i+=(a>0?"/":"")+t[a]);return n&&(o=t[t.length-1],r=n.can_cd(o),r&&(n=r,i+=(a>0?"/":"")+o+"/",o=null)),[n,o,i]}});var state=new GameState,vt,snd=new SoundBank,music=new Music(snd);user.name="Sure",user.address="DTC",snd.set("choicemove","./snd/sfx_movement_ladder5a.",["wav"]),snd.set("choiceselect","./snd/sfx_movement_ladder2a.",["wav"]),snd.set("tag","./snd/sfx_movement_ladder2a.",["wav"]),snd.set("char","./snd/char.",["wav"]),snd.set("grl","./snd/grl.",["wav"]),snd.set("poney","./snd/sfx_menu_move3.",["wav"]),snd.set("portal","./snd/sfx_movement_portal6.",["wav"]),snd.set("learned","./snd/sfx_sounds_fanfare3.",["wav"]),snd.set("unlocked","./snd/sfx_sounds_fanfare3.",["wav"]),snd.set("success","./snd/snd_5000points.",["mp3"]),snd.set("broken","./snd/sfx_exp_cluster9.",["wav"]),snd.set("hit","./snd/sfx_menu_move3.",["wav"]),snd.set("poweron","./snd/snd_steel.",["mp3"]),music.set("chapter2","./music/place/slowdrum-cave.",["wav"]),music.set("academy","./music/mystic/caravan.",["ogg"]),music.set("battle","./music/danger/snd__bairustage_loop.",["mp3"]),music.set("warning","./music/danger/trolls-beatdown-05l.",["wav"]),music.set("story","./music/cave/Searching.",["ogg"]),music.set("forest","./music/nature/Forest_Ambience.",["mp3"]),music.set("yourduty","./music/Intro_Theme.",["mp3"]),music.set("title","./music/Intro_Theme.",["mp3"]),music.set("trl","./music/danger/trolls-beatdown-05l.",["wav"]);var loadel,game_version="0.1beta",cookie_version="terminus"+game_version;newRoom("home",void 0,{writable:!0}),state.setCurrentRoom($home),$home.setEnterCallback(function(){music.play("forest")}),$home.setCmdEvent("cmd_not_found","hnotf").setCmdEvent("less_no_arg","hnoarg").setCmdEvent("destination_unreachable","hnodest").addStates({hnotf:function(e){e||setTimeout(function(){vt.unmuteSound(),mesg(_("very_first_try"),e),vt.unmuteCommandResult(),$home.unsetCmdEvent("cmd_not_found"),setTimeout(function(){vt.show_img(),global_fire_done(),state.saveCookie()},1300)},1e3)},hnoarg:cat_first_try,hnodest:cat_second_try});var shell_txt_id=0;shelly=$home.newPeople("shell").setCmdEvent("less_done","chtxt").setCmdEvent("exec_done","chtxt").addStates({chtxt:shell_dial}),$home.addPath(newRoom("western_forest","loc_forest.gif").setEnterCallback(function(){music.play("forest")})),$western_forest.newItem("western_forest_academy_direction","item_sign.png");var pwddecl=$western_forest.newItem("western_forest_back_direction").setCmdEvent("less","pwdCmd").addStates({pwdCmd:function(e){$western_forest.unsetCmdEvent("less"),_hasGroup("pwd")||(_addGroup("pwd"),learn(vt,"pwd",e))}});$western_forest.addPath(newRoom("spell_casting_academy","loc_academy.gif").setEnterCallback(function(){music.play("academy")})),$spell_casting_academy.addPath(newRoom("lessons","loc_classroom.gif"));var prof=$lessons.newPeople("professor","item_professor.png").setCmdEvent("less","learn_mv").addState("learn_mv",function(e){prof.unsetCmdEvent("less"),_addGroup("mv"),learn(vt,"mv",e)});$spell_casting_academy.addPath(newRoom("academy_practice","loc_practiceroom.png",{writable:!0})),$academy_practice.newItem("academy_practice","item_manuscript.png"),$academy_practice.addPath(newRoom("box","item_box.png",{writable:!0}).setEnterCallback(function(e,t){enterRoom(e.parents[0],t)}));var mv_pr_sum=0;$academy_practice.newItemBatch("practice",[1,2,3],"item_test.png").map(function(e){e.setCmdEvent("mv").addState("mv",mv_sum)}),man_sage=newRoom("mountain","loc_mountains.gif").newPeople("man_sage","item_mysteryman.png"),man_sage.setCmdEvent("less","exitCmd").addStates({exitCmd:function(e){man_sage.unsetCmdEvent("less"),_addGroup("exit"),learn(vt,["exit"],e),man=$mountain.newItem("man","item_manuscript.png"),man.setCmdEvent("less","manCmd").addStates({manCmd:function(e){man.unsetCmdEvent("less"),_addGroup("help"),learn(vt,["man","help"],e)}}).setCmdEvent("less_done","trueStart").addStates({trueStart:function(e){man.unsetCmdEvent("less_done"),music.play("yourduty",{loop:!0})}})}}),man_sage.setCmdEvent("less_done","manLeave").addStates({manLeave:function(e){man_sage.disappear()}});var poney_txt_id=1;$home.addPath(newRoom("meadow","loc_meadow.gif"));var poney=$meadow.newPeople("poney","item_fatpony.png").setCmdEvent("less","add_mountain").setCmdEvent("less_done","uptxt").addStates({add_mountain:function(e){$meadow.addPath($mountain),mesg(_("new_path",[$mountain]),e,{timeout:600,ondone:!0}),unlock(vt,$mountain,e),poney.unsetCmdEvent("less")},uptxt:poney_dial,uptxthint:poney_dialhint});$mountain.addPath(newRoom("cave","loc_cave.gif").addPath(newRoom("dark_corridor","loc_corridor.gif"))),$dark_corridor.addPath(newRoom("dank","loc_darkroom.gif",{writable:!0}).addCommand("mv").addPath(newRoom("small_hole",void 0,{writable:!0}).setCmdText("cd",_("room_small_hole_cd"))));var boulder=$dank.newItem("boulder","item_boulder.png",{cls:"large"}).setCmdEvent("mv","mvBoulder").addStates({mvBoulder:function(e){$dank.hasChild($tunnel)||($dank.addPath($tunnel),unlock(vt,$tunnel,e),e&&$dank.getItem("boulder").moveTo($small_hole))}}),rat_txtidx=1;newRoom("tunnel","loc_tunnel.gif").addPath(newRoom("stone_chamber","loc_portalroom.gif").addPath(newRoom("portal","item_portal.png").setEnterCallback(function(){vt.playSound("portal"),music.play("chapter1")})));var rat=$tunnel.newPeople("rat","item_rat.png",{pic_shown_in_ls:!1}).setCmdEvent("less_done","idRat").addStates({idRat:function(e){rat.setCmdEvent("less_done","ratDial"),rat.setPoDelta("_identified")},ratDial:function(e){rat.setTextIdx(rat_txtidx++)}});$portal.addPath(newRoom("townsquare","loc_square.gif")),$townsquare.setEnterCallback(function(){music.play("chapter2",{loop:!0})});var mayor_txtidx=1,mayor=$townsquare.newPeople("citizen1","item_citizen1.png").setCmdEvent("less_done","id").addStates({id:function(e){mayor.setCmdEvent("less_done","talk"),mayor.setPoDelta("_")},talk:function(e){mayor.setTextIdx(mayor_txtidx++)}});$townsquare.newPeople("citizen2","item_citizen2.png");var lady_txtidx=1,lady=$townsquare.newPeople("citizen3","item_lady.png").setCmdEvent("less_done","talk").addStates({talk:function(e){lady.setTextIdx(lady_txtidx++)}}),disabled_sell_choices=[];$townsquare.addPath(newRoom("market","loc_market.gif",{writable:!0}).addCommand("touch")),vendor=$market.newPeople("vendor","item_merchant.png").setCmdText("less","").setCmdEvent("less_done",function(){vt.show_img(),vt.ask_choose(_("people_vendor_text"),[_("people_vendor_sell_mkdir"),_("people_vendor_sell_rm"),_("people_vendor_sell_nothing")],buy_to_vendor,{disabled_choices:disabled_sell_choices})});var backpack=$market.newItem("backpack","item_backpack.png").setCmdEvent("mv",function(e){vt.show_msg(_("item_backpack_stolen")),backpack.unsetCmdEvent("mv")}).setCmdEvent("less").addStates({less:function(e){_addGroup("unzip"),learn(vt,"unzip",e),backpack.unsetCmdEvent("less"),backpack.setPoDelta([".zip"]),backpack.setCmdEvent("unzip",function(e){unzipped=[],unzipped.push(e.room.newItem("rm_cost")),unzipped.push(e.room.newItem("mkdir_cost")),backpack.setPoDelta([]),backpack.unsetCmdEvent("unzip"),vt.show_msg(_("unzipped",[_("item_backpack"),unzipped.join(", ")]),{dependant:!1})})}});$market.addStates({rmSold:function(e){_addGroup("rm"),learn(vt,"rm",e),$market.removeItem("rm_spell"),disabled_sell_choices.push(1),vendor.setCmdText("rm",_("people_vendor_rm")),global_fire_done()},mkdirSold:function(e){_addGroup("mkdir"),learn(vt,"mkdir",e),disabled_sell_choices.push(0),$market.removeItem("mkdir_spell"),global_fire_done()}}),$market.newItem("rm_spell","item_manuscript.png"),$market.newItem("mkdir_spell","item_manuscript.png"),$townsquare.addPath(newRoom("library","loc_library.gif").addCommand("grep")),lever=$library.newItem("lever","item_lever.png",{executable:!0}).setCmdEvent("exec","pullLever").addStates({pullLever:function(e){$library.addPath($backroom),e||vt.show_msg(_("item_lever_exec")),lever.disappear()}}),$library.newItem("historybook","item_historybook.png"),$library.newItem("nostalgicbook","item_historybook.png").setCmdEvent("less","pwdCmd").addStates({pwdCmd:function(e){$western_forest.fire_event("pwdCmd")}}),$library.newItem("romancebook","item_romancenovel.png"),$library.newItem("itemspellbook","item_radspellbook.png"),$library.newItem("radspellbook","item_radspellbook.png"),vimbook=$library.newItem("vimbook","item_vimbook.png").setCmdEvent("less","openVim").addState("openVim",function(e){e||(vt.flash(1600,1e3),vt.rmCurrentImg(2650)),vimbook.disappear()}),newRoom("backroom","loc_backroom.gif").addCommand("grep"),$backroom.newPeople("grep","grep.png").setCmdEvent("less","grep").addStates({grep:function(e){_addGroup("grep"),learn(vt,"grep",e)}}),$backroom.newPeople("librarian","item_librarian.png"),$townsquare.addPath(newRoom("rockypath","loc_rockypath.gif",{writable:!0})),$rockypath.newItem("largeboulder","item_boulder.png").setCmdText("rm",_("item_largeboulder_rm")).setCmdEvent("rm").addStates({rm:function(e){$rockypath.addPath($farm),e&&e&&$rockypath.removeItem("largeboulder")}}),$townsquare.addPath(newRoom("artisanshop","loc_artisanshop.gif").setCmdEvents({touch:function(e){if(e.arg===_("item_gear"))return"touchGear"},cp:function(e){var t=new RegExp(_("item_gear")+"\\d");if(t.test(e.arg)){for(var n=1;n<6;n++)if(!e.room.getItemFromName(_("item_gear",[n])))return"";return"FiveGearsCopied"}}},!0).addStates({touchGear:function(e){Artisan.setCmdText("less",_("item_gear_touch")),$artisanshop.addCommand("cp"),_addGroup("cp"),learn(vt,"cp",e),e?$artisanshop.newItem("gear","item_gear.png"):$artisanshop.getItem("gear").setPic("item_gear.png"),state.saveCookie()},FiveGearsCopied:function(e){Artisan.setCmdText("less",_("item_gear_artisans_ok")),$artisanshop.removeItem("gear"),e||($artisanshop.removeItem("gear",[1]),$artisanshop.removeItem("gear",[2]),$artisanshop.removeItem("gear",[3]),$artisanshop.removeItem("gear",[4]),$artisanshop.removeItem("gear",[5]),success(vt,"room_artisanshop",e)),state.saveCookie()}})),$artisanshop.newItem("strangetrinket","item_trinket.png").setCmdText("rm",_("item_strangetrinket_rm")).setCmdText("mv",_("item_strangetrinket_mv")),$artisanshop.newItem("dragon","item_clockdragon.png",{pic_shown_in_ls:!1}).setCmdText("rm",_("item_dragon_rm")).setCmdText("mv",_("item_dragon_mv"));var Artisan=$artisanshop.newPeople("artisan","item_artisan.png").setCmdEvent("less","touch").addStates({touch:function(e){_addGroup("touch"),learn(vt,"touch",e),Artisan.unsetCmdEvent("less"),state.saveCookie()}});newRoom("farm","loc_farm.gif").addCommand("cp").newItem("earofcorn","item_corn.png").setCmdText("rm",_("item_earofcorn_rm")).setCmdEvent("cp","CornCopied").addStates({CornCopied:function(e){Farmer.setCmdText("less",_("corn_farmer_ok")),e&&$farm.newItem("another_earofcorn")}});var Farmer=$farm.newPeople("farmer","item_farmer.png");$townsquare.addPath(newRoom("brokenbridge","loc_bridge.gif").setCmdEvent("touch",function(e){return e.arg===_("item_plank")?"touchPlank":""}).addCommand("touch").addStates({touchPlank:function(e){$clearing.addCommand("cd"),$clearing.unsetCmdText("cd"),$clearing.setExecutable(!0),$brokenbridge.unsetCmdText("cd"),$brokenbridge.setIntroText(_("room_brokenbridge_text2")),e?$brokenbridge.newItem("plank","item_plank.png"):($brokenbridge.getItem("plank").setPic("item_plank.png"),vt.echo(_("room_brokenbridge_text2")))}})),$brokenbridge.addPath(newRoom("clearing","loc_clearing.gif",{writable:!0,executable:!1}).setCmdEvent("mkdir",function(e){return e.arg==_("room_house")?"HouseMade":""}).setCmdText("cd",_("room_clearing_cd")).addCommand("mkdir").addStates({HouseMade:function(e){e&&$clearing.addPath(newRoom("house")),$clearing.getChildFromName(_("room_house")).setCmdText("cd",_("room_house_cd")).setCmdText("ls",_("room_house_ls")),success(vt,"room_house",e),$clearing.unsetCmdText("cd"),$clearing.setIntroText(_("room_clearing_text2")),CryingMan.setCmdText("less",_("room_clearing_less2"))}}));var CryingMan=$clearing.newPeople("cryingman","item_man.png");$clearing.addPath(newRoom("ominouspath","loc_path.gif",{writable:!0})),$ominouspath.newItem("brambles","item_brambles.png",{cls:"large"}).setCmdEvent("rm","rmBrambles").setCmdText("mv",_("item_brambles_mv")).setCmdText("rm",_("item_brambles_rm")).addStates({rmBrambles:function(e){$ominouspath.addPath($trollcave),e&&$ominouspath.removeItem("brambles")}});var troll_evt=function(e){return"UglyTroll"==e.arg?"openSlide":""};newRoom("trollcave","loc_cave.gif",{writable:!0}).setCmdEvent("mv",troll_evt).setCmdEvent("rm",troll_evt),$trollcave.newPeople("troll1","item_troll1.png").setCmdText("rm",_("people_troll1_rm")).setCmdText("mv",_("people_troll1_mv")).setCmdText("cp",_("people_troll1_cp")).setCmdEvent("mv","openSlide").setCmdEvent("rm","openSlide").addStates({openSlide:function(e){$slide.addCommand("cd"),$slide.setExecutable(!0),$slide.setCmdText("cd",_("room_slide_cd2")),

e&&$trollcave.removePeople("troll1")}}),$trollcave.newPeople("troll2","item_troll2.png").setCmdText("rm",_("people_troll1_rm")),$trollcave.newPeople("supertroll","item_supertroll.png").setCmdText("rm",_("people_supertroll_rm")).setCmdText("mv",_("people_supertroll_mv")),$trollcave.addPath(newRoom("cage","item_cage.png",{cls:"covering",writable:!0,executable:!1,pic_shown_as_item:!0}).setCmdText("cd",_("room_cage_cd")));var Kid=$cage.newPeople("kidnapped","item_boy.png").setCmdText("mv",_("people_kidnapped_mv")).setCmdEvent("mv","freekid").addStates({freeKid:function(){Kid.moveTo($clearing)}});$trollcave.addPath(newRoom("slide",null,{executable:!1}).setCmdText("cd",_("room_slide_cd"))),$slide.addPath(newRoom("kernel").addCommand("sudo").addCommand("grep")),$kernel.newItem("certificate",void 0,{readable:!1}).setCmdEvent("unreadable",function(e){e.term.echo(_("item_certificate_alert"))}).setCmdEvent("less_done","sudoComplete").addStates({sudoComplete:function(e){$kernel.addPath($paradise),mesg(_("new_path",[$paradise]),e,{timeout:600,ondone:!0}),unlock(vt,$paradise,e)}}),$kernel.newItem("sudo_teaser").setCmdEvent("less","sudo").addStates({sudo:function(e){_addGroup("sudo"),learn(vt,"sudo",e)}}),$kernel.newItem("instructions"),$kernel.addPath(newRoom("morekernel").addCommand("grep"));var $bigfiles=$morekernel.newItemBatch("bigfile",["L","M","Q","R","S","T","U","V","W"]);$bigfiles.filter(function(e){e.setCmdText("grep_overflow",_("grep_long"))}),$bigfiles[Math.floor(9*Math.random())].setCmdText("grep","password = IHTFP"),newRoom("paradise","loc_theend.gif").setCmdText("ls",_("room_paradise_ls")).setCmdEvent("ls_done","gameover").addStates({gameover:function(e){e||vt.echo(_("room_paradise_ls")),mesg(_("gameover"),e,{timeout:3e4,ondone:!0}),mesg(_("gameover1"),e,{timeout:6e4,ondone:!0}),mesg(_("gameover2"),e,{timeout:18e4,ondone:!0}),mesg(_("gameover3"),e,{timeout:196e3,ondone:!0})}}),console.log("Game objects : init"),app_loaded();</script></body></html>